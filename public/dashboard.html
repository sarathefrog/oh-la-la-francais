<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูพูู ูุฏุฑุช - ุฒูุฑุง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background: 'var(--background)',
                        foreground: 'var(--foreground)',
                        card: 'var(--card)',
                        'card-foreground': 'var(--card-foreground)',
                        popover: 'var(--popover)',
                        'popover-foreground': 'var(--popover-foreground)',
                        primary: 'var(--primary)',
                        'primary-foreground': 'var(--primary-foreground)',
                        secondary: 'var(--secondary)',
                        'secondary-foreground': 'var(--secondary-foreground)',
                        muted: 'var(--muted)',
                        'muted-foreground': 'var(--muted-foreground)',
                        accent: 'var(--accent)',
                        'accent-foreground': 'var(--accent-foreground)',
                        destructive: 'var(--destructive)',
                        'destructive-foreground': 'var(--destructive-foreground)',
                        border: 'var(--border)',
                        input: 'var(--input)',
                        ring: 'var(--ring)',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --background: #ffffff;
            --foreground: #0f0f23;
            --card: #ffffff;
            --card-foreground: #0f0f23;
            --popover: #ffffff;
            --popover-foreground: #0f0f23;
            --primary: #030213;
            --primary-foreground: #ffffff;
            --secondary: #f3f3f5;
            --secondary-foreground: #030213;
            --muted: #ececf0;
            --muted-foreground: #717182;
            --accent: #e9ebef;
            --accent-foreground: #030213;
            --destructive: #d4183d;
            --destructive-foreground: #ffffff;
            --border: rgba(0, 0, 0, 0.1);
            --input: transparent;
            --ring: #0f0f23;
        }
        
        .dark {
            --background: #0f0f23;
            --foreground: #ffffff;
            --card: #0f0f23;
            --card-foreground: #ffffff;
            --popover: #0f0f23;
            --popover-foreground: #ffffff;
            --primary: #ffffff;
            --primary-foreground: #0f0f23;
            --secondary: #1a1a2e;
            --secondary-foreground: #ffffff;
            --muted: #1a1a2e;
            --muted-foreground: #717182;
            --accent: #1a1a2e;
            --accent-foreground: #ffffff;
            --destructive: #d4183d;
            --destructive-foreground: #ffffff;
            --border: #1a1a2e;
            --input: #1a1a2e;
            --ring: #ffffff;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 via-purple-50 to-pink-100 min-h-screen">
    <div class="flex min-h-screen">
        <!-- Mobile Navigation -->
        <div class="lg:hidden fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-md border-b border-pink-200 p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-pink-300 to-purple-300 rounded-2xl flex items-center justify-center shadow-lg">
                        <span class="text-white text-lg">๐</span>
                    </div>
                    <div>
                        <h1 class="text-pink-600 font-semibold">ุฑุจุงุช ฺฉูุงุณ ูุฑุงูุณู ุฒูุฑุง</h1>
                        <p class="text-xs text-pink-400">ูพูู ูุฏุฑุช</p>
                    </div>
                </div>
                <button id="mobile-menu-btn" class="p-2 rounded-lg bg-pink-100 text-pink-600 hover:bg-pink-200 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Desktop Sidebar -->
        <aside class="hidden lg:flex w-80 bg-white/80 backdrop-blur-sm border-r border-pink-200 shadow-xl flex-col">
            <div class="flex flex-col h-full">
                <div class="p-6 border-b border-pink-200">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-12 h-12 bg-gradient-to-br from-pink-300 to-purple-300 rounded-2xl flex items-center justify-center shadow-lg">
                            <span class="text-white text-2xl">๐</span>
                        </div>
                        <div>
                            <h1 class="text-pink-600 font-bold text-lg">ุฑุจุงุช ฺฉูุงุณ ูุฑุงูุณู ุฒูุฑุง</h1>
                            <p class="text-sm text-pink-400 flex items-center gap-1">
                                <span>โจ</span>
                                ูพูู ูุฏุฑุช
                            </p>
                        </div>
                    </div>
                </div>

                <div class="flex-1 p-4 overflow-y-auto">
                    <nav class="space-y-1.5">
                        <button onclick="setActiveSection('dashboard')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-dashboard">
                            <div class="w-9 h-9 bg-pink-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐</span>
                            </div>
                            <span class="text-sm">ุฏุงุดุจูุฑุฏ</span>
                        </button>
                        
                        <button onclick="setActiveSection('students')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-students">
                            <div class="w-9 h-9 bg-purple-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐ฅ</span>
                            </div>
                            <span class="text-sm">ุฏุงูุดโุขููุฒุงู</span>
                        </button>
                        
                        <button onclick="setActiveSection('classes')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-classes">
                            <div class="w-9 h-9 bg-blue-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐</span>
                            </div>
                            <span class="text-sm">ฺฉูุงุณโูุง</span>
                        </button>
                        
                        <button onclick="setActiveSection('cancelled')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-cancelled">
                            <div class="w-9 h-9 bg-red-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">โ</span>
                            </div>
                            <span class="text-sm">ฺฉูุงุณโูุง ฺฉูุณู ุดุฏู</span>
                        </button>
                        
                        <button onclick="setActiveSection('questions')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-questions">
                            <div class="w-9 h-9 bg-orange-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">โ</span>
                            </div>
                            <span class="text-sm">ุณูุงูุงุช</span>
                        </button>
                        
                        <button onclick="setActiveSection('cancelled-classes')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-cancelled-classes">
                            <div class="w-9 h-9 bg-red-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">โ</span>
                            </div>
                            <span class="text-sm">ฺฉูุงุณโูุง ูุบู ุดุฏู</span>
                        </button>
                        
                        <button onclick="setActiveSection('homework')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-homework">
                            <div class="w-9 h-9 bg-rose-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐</span>
                            </div>
                            <span class="text-sm">ุชฺฉุงูู</span>
                        </button>
                        
                        <button onclick="setActiveSection('test-classes')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-test-classes">
                            <div class="w-9 h-9 bg-green-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐</span>
                            </div>
                            <span class="text-sm">ฺฉูุงุณโูุง ุขุฒูุงุด</span>
                        </button>
                        
                        <button onclick="setActiveSection('calendar')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-calendar">
                            <div class="w-9 h-9 bg-blue-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐</span>
                            </div>
                            <span class="text-sm">ุชููู</span>
                        </button>
                        
                        <button onclick="setActiveSection('payments')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-payments">
                            <div class="w-9 h-9 bg-emerald-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐ฐ</span>
                            </div>
                            <span class="text-sm">ูพุฑุฏุงุฎุชโูุง</span>
                        </button>
                        
                        <button onclick="setActiveSection('analytics')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-analytics">
                            <div class="w-9 h-9 bg-cyan-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐</span>
                            </div>
                            <span class="text-sm">ุขูุงุฑ ู ฺฏุฒุงุฑุดโูุง</span>
                        </button>
                        
                        <button onclick="setActiveSection('notifications')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-notifications">
                            <div class="w-9 h-9 bg-yellow-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">๐</span>
                            </div>
                            <span class="text-sm">ุงุทูุงุนโุฑุณุงูโูุง</span>
                        </button>
                        
                        <button onclick="setActiveSection('settings')" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="nav-settings">
                            <div class="w-9 h-9 bg-slate-200 rounded-xl flex items-center justify-center">
                                <span class="text-lg">โ๏ธ</span>
                            </div>
                            <span class="text-sm">ุชูุธูุงุช</span>
                        </button>
                    </nav>
                </div>

                <div class="p-4 border-t border-pink-200">
                    <div class="p-4 bg-gradient-to-br from-pink-100 to-purple-100 rounded-2xl">
                        <p class="text-sm text-pink-600 text-center">
                            โจ ุณุงุฎุชู ุดุฏู ุจุง ุนุดู ุจุฑุง ุฒุจุงูโุขููุฒุงู ูุฑุงูุณู ๐
                        </p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Mobile Sidebar Overlay -->
        <div id="mobile-sidebar" class="lg:hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm hidden">
            <div class="fixed inset-y-0 left-0 w-80 bg-white/95 backdrop-blur-md shadow-xl">
                <div class="flex flex-col h-full">
                    <div class="p-6 border-b border-pink-200">
                        <div class="flex items-center gap-3 mb-2">
                            <div class="w-12 h-12 bg-gradient-to-br from-pink-300 to-purple-300 rounded-2xl flex items-center justify-center shadow-lg">
                                <span class="text-white text-2xl">๐</span>
                            </div>
                            <div>
                                <h1 class="text-pink-600 font-bold text-lg">ุฑุจุงุช ฺฉูุงุณ ูุฑุงูุณู ุฒูุฑุง</h1>
                                <p class="text-sm text-pink-400 flex items-center gap-1">
                                    <span>โจ</span>
                                    ูพูู ูุฏุฑุช
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="flex-1 p-4 overflow-y-auto">
                        <nav class="space-y-1.5">
                            <button onclick="setActiveSection('dashboard'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-dashboard">
                                <div class="w-9 h-9 bg-pink-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐</span>
                                </div>
                                <span class="text-sm">ุฏุงุดุจูุฑุฏ</span>
                            </button>
                            
                            <button onclick="setActiveSection('students'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-students">
                                <div class="w-9 h-9 bg-purple-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐ฅ</span>
                                </div>
                                <span class="text-sm">ุฏุงูุดโุขููุฒุงู</span>
                            </button>
                            
                            <button onclick="setActiveSection('classes'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-classes">
                                <div class="w-9 h-9 bg-blue-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐</span>
                                </div>
                                <span class="text-sm">ฺฉูุงุณโูุง</span>
                            </button>
                            
                            <button onclick="setActiveSection('cancelled-classes'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-cancelled-classes">
                                <div class="w-9 h-9 bg-red-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">โ</span>
                                </div>
                                <span class="text-sm">ฺฉูุงุณโูุง ูุบู ุดุฏู</span>
                            </button>
                            
                            <button onclick="setActiveSection('questions'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-questions">
                                <div class="w-9 h-9 bg-orange-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">โ</span>
                                </div>
                                <span class="text-sm">ุณูุงูุงุช</span>
                            </button>
                            
                            <button onclick="setActiveSection('homework'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-homework">
                                <div class="w-9 h-9 bg-rose-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐</span>
                                </div>
                                <span class="text-sm">ุชฺฉุงูู</span>
                            </button>
                            
                            <button onclick="setActiveSection('test-classes'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-test-classes">
                                <div class="w-9 h-9 bg-green-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐</span>
                                </div>
                                <span class="text-sm">ฺฉูุงุณโูุง ุขุฒูุงุด</span>
                            </button>
                            
                            <button onclick="setActiveSection('calendar'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-calendar">
                                <div class="w-9 h-9 bg-blue-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐</span>
                                </div>
                                <span class="text-sm">ุชููู</span>
                            </button>
                            
                            <button onclick="setActiveSection('payments'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-payments">
                                <div class="w-9 h-9 bg-emerald-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐ฐ</span>
                                </div>
                                <span class="text-sm">ูพุฑุฏุงุฎุชโูุง</span>
                            </button>
                            
                            <button onclick="setActiveSection('analytics'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-analytics">
                                <div class="w-9 h-9 bg-cyan-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐</span>
                                </div>
                                <span class="text-sm">ุขูุงุฑ ู ฺฏุฒุงุฑุดโูุง</span>
                            </button>
                            
                            <button onclick="setActiveSection('notifications'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-notifications">
                                <div class="w-9 h-9 bg-yellow-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">๐</span>
                                </div>
                                <span class="text-sm">ุงุทูุงุนโุฑุณุงูโูุง</span>
                            </button>
                            
                            <button onclick="setActiveSection('settings'); closeMobileMenu()" class="w-full flex items-center gap-3 h-12 rounded-xl transition-all hover:bg-pink-50 text-gray-600 hover:scale-102" id="mobile-nav-settings">
                                <div class="w-9 h-9 bg-slate-200 rounded-xl flex items-center justify-center">
                                    <span class="text-lg">โ๏ธ</span>
                                </div>
                                <span class="text-sm">ุชูุธูุงุช</span>
                            </button>
                        </nav>
                    </div>

                    <div class="p-4 border-t border-pink-200">
                        <div class="p-4 bg-gradient-to-br from-pink-100 to-purple-100 rounded-2xl">
                            <p class="text-sm text-pink-600 text-center">
                                โจ ุณุงุฎุชู ุดุฏู ุจุง ุนุดู ุจุฑุง ุฒุจุงูโุขููุฒุงู ูุฑุงูุณู ๐
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8 pt-20 lg:pt-8 overflow-x-hidden w-full max-w-full">
            <!-- Notification Area -->
            <div id="notification-area" class="mb-6">
                <!-- Notifications will be displayed here -->
            </div>
            
            <!-- Clear Notifications Button -->
            <div class="flex justify-end mb-4 gap-2">
                <button onclick="clearAllNotifications()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg transition-colors text-sm">
                    ูพุงฺฉ ฺฉุฑุฏู ููู ุงุนูุงูโูุง
                </button>
                <!-- Test Modal Buttons (for testing) -->
                <button onclick="testModal('success')" class="px-4 py-2 bg-green-100 hover:bg-green-200 text-green-600 rounded-lg transition-colors text-sm">
                    ุชุณุช ููููุช
                </button>
                <button onclick="testModal('error')" class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors text-sm">
                    ุชุณุช ุฎุทุง
                </button>
                <button onclick="testModal('warning')" class="px-4 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-600 rounded-lg transition-colors text-sm">
                    ุชุณุช ูุดุฏุงุฑ
                </button>
                <button onclick="testTeacherApproval()" class="px-4 py-2 bg-green-100 hover:bg-green-200 text-green-600 rounded-lg transition-colors text-sm">
                    ุชุณุช ุชุฃุฏ ูุนูู
                </button>
                <button onclick="testPaymentReminder()" class="px-4 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-600 rounded-lg transition-colors text-sm">
                    ุชุณุช ุงุฏุขูุฑ ูพุฑุฏุงุฎุช
                </button>
            </div>
        
        <!-- Custom Confirmation Modal -->
        <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
                <div class="p-6">
                    <!-- Modal Header -->
                    <div class="flex items-center gap-3 mb-4">
                        <div id="modal-icon" class="w-12 h-12 rounded-full flex items-center justify-center">
                            <span id="modal-icon-text" class="text-2xl">โ๏ธ</span>
                        </div>
                        <div>
                            <h3 id="modal-title" class="text-lg font-semibold text-gray-800">ุชุฃุฏ ุนููุงุช</h3>
                            <p id="modal-subtitle" class="text-sm text-gray-500">ูุทูุงู ุชุฃุฏ ฺฉูุฏ</p>
                        </div>
                    </div>
                    
                    <!-- Modal Body -->
                    <div class="mb-6">
                        <p id="modal-message" class="text-gray-700 leading-relaxed">
                            ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ุนููุงุช ุฑุง ุงูุฌุงู ุฏูุฏุ
                        </p>
                        <div id="modal-details" class="mt-3 p-3 bg-gray-50 rounded-lg text-sm text-gray-600">
                            <!-- Additional details will be shown here -->
                        </div>
                    </div>
                    
                    <!-- Modal Actions -->
                    <div class="flex gap-3 justify-end">
                        <button id="modal-cancel" onclick="hideConfirmationModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors font-medium">
                            ุงูุตุฑุงู
                        </button>
                        <button id="modal-confirm" onclick="confirmAction()" class="px-6 py-2 rounded-xl transition-colors font-medium text-white">
                            ุชุฃุฏ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Details Modal -->
        <div id="view-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="view-modal-content">
                <div class="p-6">
                    <!-- Modal Header -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div id="view-modal-icon" class="w-12 h-12 rounded-full flex items-center justify-center bg-blue-100">
                                <span id="view-modal-icon-text" class="text-2xl">๐ค</span>
                            </div>
                            <div>
                                <h3 id="view-modal-title" class="text-xl font-semibold text-gray-800">ุฌุฒุฆุงุช ุฏุงูุดโุขููุฒ</h3>
                                <p id="view-modal-subtitle" class="text-sm text-gray-500">ุงุทูุงุนุงุช ฺฉุงูู</p>
                            </div>
                        </div>
                        <button onclick="hideViewModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Modal Body -->
                    <div id="view-modal-body" class="space-y-6">
                        <!-- Content will be dynamically generated -->
                    </div>
                    
                    <!-- Modal Actions -->
                    <div class="flex gap-3 justify-end mt-6 pt-4 border-t border-gray-200">
                        <button onclick="hideViewModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors font-medium">
                            ุจุณุชู
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Approval Modal -->
        <div id="teacher-approval-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="teacher-approval-modal-content">
                <div class="p-6">
                    <!-- Modal Header -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-green-100">
                                <span class="text-2xl">๐ฉโ๐ซ</span>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-gray-800">ุชุฃุฏ ู ุชูุธู ฺฉูุงุณ</h3>
                                <p id="teacher-approval-student-name" class="text-sm text-gray-500">ุฏุงูุดโุขููุฒ</p>
                            </div>
                        </div>
                        <button onclick="hideTeacherApprovalModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Modal Body -->
                    <div class="space-y-6">
                        <!-- Student Information Summary -->
                        <div id="teacher-approval-student-info" class="bg-gray-50 rounded-lg p-4">
                            <!-- Student info will be populated here -->
                        </div>

                        <!-- Class Configuration -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-gray-800">ุชูุธูุงุช ฺฉูุงุณ</h4>
                            
                            <!-- Sessions Configuration -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ุชุนุฏุงุฏ ฺฉู ุฌูุณุงุช</label>
                                    <input type="number" id="total-sessions" min="1" max="50" value="10" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ุฌูุณุงุช ุฏุฑ ููุชู</label>
                                    <select id="sessions-per-week" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                                        <option value="1">1 ุฌูุณู</option>
                                        <option value="2">2 ุฌูุณู</option>
                                        <option value="3">3 ุฌูุณู</option>
                                        <option value="4">4 ุฌูุณู</option>
                                        <option value="5">5 ุฌูุณู</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Days and Times Configuration -->
                            <div class="space-y-4">
                                <h5 class="text-md font-semibold text-gray-700">ุฑูุฒูุง ู ุณุงุนุงุช ฺฉูุงุณ</h5>
                                <div id="class-schedule-config">
                                    <!-- Dynamic class schedule configuration will be added here -->
                                </div>
                                <button onclick="addClassSchedule()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                    + ุงูุฒูุฏู ุฑูุฒ ู ุณุงุนุช
                                </button>
                            </div>

                            <!-- Payment Status -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ูุถุนุช ูพุฑุฏุงุฎุช</label>
                                <select id="payment-status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                                    <option value="unpaid">ูพุฑุฏุงุฎุช ูุดุฏู</option>
                                    <option value="paid">ูพุฑุฏุงุฎุช ุดุฏู</option>
                                    <option value="overdue">ูพุฑุฏุงุฎุช ูุนูู</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal Actions -->
                    <div class="flex gap-3 justify-end mt-6 pt-4 border-t border-gray-200">
                        <button onclick="hideTeacherApprovalModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors font-medium">
                            ุงูุตุฑุงู
                        </button>
                        <button onclick="approveStudentWithSettings()" class="px-6 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors font-medium">
                            ุชุฃุฏ ู ุซุจุช
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Reminder Modal -->
        <div id="payment-reminder-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="payment-reminder-modal-content">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">๐ฐ ุงุฏุขูุฑ ูพุฑุฏุงุฎุช</h3>
                        <button onclick="hidePaymentReminderModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <p class="text-sm text-yellow-800">
                                <strong id="payment-student-name">ูุงู ุฏุงูุดุฌู</strong> - ุงุฏุขูุฑ ูพุฑุฏุงุฎุช
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ูุจูุบ ูพุฑุฏุงุฎุช (ุชููุงู)</label>
                            <input type="number" id="payment-amount" value="500000" min="0" step="1000" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ูพุงู ุงุถุงู (ุงุฎุชุงุฑ)</label>
                            <textarea id="payment-message" rows="3" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                      placeholder="ูพุงู ุงุถุงู ุจุฑุง ุฏุงูุดุฌู..."></textarea>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 justify-end mt-6 pt-4 border-t border-gray-200">
                        <button onclick="hidePaymentReminderModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors font-medium">
                            ุงูุตุฑุงู
                        </button>
                        <button onclick="sendCustomPaymentReminder()" class="px-6 py-2 bg-yellow-500 text-white rounded-xl hover:bg-yellow-600 transition-colors font-medium">
                            ุงุฑุณุงู ุงุฏุขูุฑ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Payment Reminder Modal -->
        <div id="bulk-payment-reminder-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="bulk-payment-reminder-modal-content">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">๐ฐ ุงุฏุขูุฑ ูพุฑุฏุงุฎุช ฺฏุฑูู</h3>
                        <button onclick="hideBulkPaymentReminderModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <p class="text-sm text-blue-800">
                                ุงู ุนูู ุงุฏุขูุฑ ูพุฑุฏุงุฎุช ุฑุง ุจุฑุง ุชูุงู ุฏุงูุดโุขููุฒุงู ฺฉู ูพุฑุฏุงุฎุช ูฺฉุฑุฏูโุงูุฏ ุงุฑุณุงู ูโฺฉูุฏ.
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ูุจูุบ ูพุฑุฏุงุฎุช (ุชููุงู)</label>
                            <input type="number" id="bulk-payment-amount" value="500000" min="0" step="1000" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ูพุงู ุงุถุงู (ุงุฎุชุงุฑ)</label>
                            <textarea id="bulk-payment-message" rows="3" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                      placeholder="ูพุงู ุงุถุงู ุจุฑุง ุฏุงูุดุฌูุงู..."></textarea>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 justify-end mt-6 pt-4 border-t border-gray-200">
                        <button onclick="hideBulkPaymentReminderModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors font-medium">
                            ุงูุตุฑุงู
                        </button>
                        <button onclick="sendBulkPaymentReminders()" class="px-6 py-2 bg-yellow-500 text-white rounded-xl hover:bg-yellow-600 transition-colors font-medium">
                            ุงุฑุณุงู ุจู ููู
                        </button>
                    </div>
                </div>
            </div>
        </div>
            
            <div class="max-w-full">
                <!-- Dashboard Overview -->
                <div id="dashboard-content" class="space-y-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ ููุง ฺฉู ุฏุงุดุจูุฑุฏ
                            </h2>
                            <p class="text-gray-600">ุฎูุด ุขูุฏุฏ! ุงูุฌุง ุขูฺู ุงูุฑูุฒ ุงุชูุงู ูโุงูุชุฏ ุฑุง ูโุจูุฏ โจ</p>
                        </div>
                        <div class="bg-gradient-to-r from-pink-400 to-purple-400 text-white px-4 py-2 rounded-lg font-medium">
                            <span id="current-date"></span>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="stats-container">
                        <!-- Stats will be loaded here -->
                    </div>

                    <!-- Main Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Upcoming Classes -->
                        <div class="bg-white/80 backdrop-blur-sm border border-pink-200 rounded-xl shadow-lg">
                            <div class="p-6 border-b border-pink-200">
                                <h3 class="text-pink-600 flex items-center gap-2 text-lg font-semibold">
                                    ๐ ฺฉูุงุณโูุง ูพุด ุฑู (ท ุฑูุฒ ุขูุฏู)
                                </h3>
                                <p class="text-gray-600 text-sm">ฺฉูุงุณโูุง ุจุฑูุงููโุฑุฒ ุดุฏู ุจุฑุง ุงู ููุชู</p>
                            </div>
                            <div class="p-6">
                                <div class="space-y-3" id="upcoming-classes">
                                    <!-- Classes will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Recent Questions -->
                        <div class="bg-white/80 backdrop-blur-sm border border-pink-200 rounded-xl shadow-lg">
                            <div class="p-6 border-b border-pink-200">
                                <h3 class="text-purple-600 flex items-center gap-2 text-lg font-semibold">
                                    โ ุณูุงูุงุช ุงุฎุฑ (ุจุฏูู ูพุงุณุฎ)
                                </h3>
                                <p class="text-gray-600 text-sm">ุณูุงูุงุช ุฏุงูุดโุขููุฒุงู ุฏุฑ ุงูุชุธุงุฑ ูพุงุณุฎ</p>
                            </div>
                            <div class="p-6">
                                <div class="space-y-3" id="recent-questions">
                                    <!-- Questions will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Homework Submissions -->
                    <div class="bg-white/80 backdrop-blur-sm border border-pink-200 rounded-xl shadow-lg">
                        <div class="p-6 border-b border-pink-200">
                            <h3 class="text-rose-600 flex items-center gap-2 text-lg font-semibold">
                                ๐ ุงุฑุณุงูโูุง ุงุฎุฑ ุชฺฉุงูู
                            </h3>
                            <p class="text-gray-600 text-sm">ุขุฎุฑู ุชฺฉุงูู ุงุฑุณุงู ุดุฏู ุชูุณุท ุฏุงูุดโุขููุฒุงู</p>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="homework-submissions">
                                <!-- Homework will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Quick Tips and Tasks -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gradient-to-br from-pink-100 to-purple-100 border border-pink-200 rounded-xl">
                            <div class="p-6">
                                <h3 class="text-pink-600 text-lg font-semibold mb-4">๐ก ูฺฉุงุช ุณุฑุน</h3>
                                <ul class="space-y-2 text-sm text-pink-700">
                                    <li>โจ ุซุจุชโูุงูโูุง ุฏุฑ ุงูุชุธุงุฑ ุฏุงูุดโุขููุฒุงู ุฑุง ุฏุฑ ุชุจ ุฏุงูุดโุขููุฒุงู ุจุฑุฑุณ ฺฉูุฏ</li>
                                    <li>๐ฌ ุณูุงูุงุช ุงุฎุฑ ุฑุง ูพุงุณุฎ ุฏูุฏ ุชุง ูุดุงุฑฺฉุช ุจุงูุง ุจูุงูุฏ</li>
                                    <li>๐ ฺฉูุงุณโูุง ูพุด ุฑู ุฑุง ุจุฑุฑุณ ฺฉูุฏ ู ุงุฏุขูุฑ ุงุฑุณุงู ฺฉูุฏ</li>
                                    <li>๐ ุชฺฉุงูู ุงุฑุณุงู ุดุฏู ุฑุง ูุจู ุงุฒ ุขุฎุฑ ููุชู ุจุฑุฑุณ ฺฉูุฏ</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-purple-100 to-rose-100 border border-pink-200 rounded-xl">
                            <div class="p-6">
                                <h3 class="text-purple-600 text-lg font-semibold mb-4">๐ฏ ูุธุงู ุงูุฑูุฒ</h3>
                                <ul class="space-y-2 text-sm text-purple-700" id="todays-tasks">
                                    <!-- Tasks will be loaded here -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Students Management -->
                <div id="students-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ฅ ูุฏุฑุช ุฏุงูุดโุขููุฒุงู
                            </h2>
                            <p class="text-gray-600">ูุฏุฑุช ุงุทูุงุนุงุช ู ุซุจุชโูุงู ุฏุงูุดโุขููุฒุงู โจ</p>
                        </div>
                    </div>


                    <!-- Student Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="student-stats">
                        <!-- Student stats will be loaded here -->
                    </div>

                    <!-- Students Table -->
                    <div class="bg-white/80 backdrop-blur-sm border border-pink-200 rounded-xl shadow-lg">
                        <div class="p-6 border-b border-pink-200">
                            <h3 class="text-pink-600 text-lg font-semibold">ุงุทูุงุนุงุช ุฏุงูุดโุขููุฒุงู</h3>
                            <p class="text-gray-600 text-sm">ูุดุงูุฏู ู ูุฏุฑุช ุชูุงู ุฌุฒุฆุงุช ุฏุงูุดโุขููุฒุงู</p>
                        </div>
                        <div class="p-6">
                            <!-- Tabs -->
                            <div class="bg-pink-100 p-1 rounded-xl mb-6 flex">
                                <button onclick="setStudentTab('all')" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all" id="tab-all">
                                    ููู ุฏุงูุดโุขููุฒุงู
                                </button>
                                <button onclick="setStudentTab('approved')" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all" id="tab-approved">
                                    ุชุฃุฏ ุดุฏู
                                </button>
                                <button onclick="setStudentTab('pending')" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all" id="tab-pending">
                                    ุฏุฑ ุงูุชุธุงุฑ
                                </button>
                                <button onclick="setStudentTab('existing-pending')" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all" id="tab-existing-pending">
                                    ุฏุฑ ุงูุชุธุงุฑ ููุฌูุฏ
                                </button>
                            </div>

                            <!-- Students Table -->
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-pink-200">
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุฏุงูุดโุขููุฒ</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุชูุงุณ</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุณุทุญ</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ููุน ฺฉูุงุณ</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุฌูุณุงุช ุจุงูโูุงูุฏู</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ูพุฑุฏุงุฎุช</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ูุถุนุช</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุงุฏุขูุฑ ูพุฑุฏุงุฎุช</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุนููุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody id="students-table-body">
                                        <!-- Students will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Classes Schedule -->
                <div id="classes-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ ุจุฑูุงูู ฺฉูุงุณโูุง
                            </h2>
                            <p class="text-gray-600">ูุฏุฑุช ุจุฑูุงููโูุง ฺฉูุงุณ ู ุฒูุงูโุจูุฏ</p>
                        </div>
                    </div>
                    <div id="classes-schedule-content">
                        <!-- Classes content will be loaded here -->
                    </div>
                </div>

                <!-- Cancelled Classes -->
                <div id="cancelled-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                โ ฺฉูุงุณโูุง ฺฉูุณู ุดุฏู
                            </h2>
                            <p class="text-gray-600">ูุดุงูุฏู ู ูุฏุฑุช ฺฉูุงุณโูุง ฺฉูุณู ุดุฏู</p>
                        </div>
                    </div>
                    <div id="cancelled-classes-content">
                        <!-- Cancelled classes content will be loaded here -->
                    </div>
                </div>

                <!-- Questions & Support -->
                <div id="questions-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                โ ุณูุงูุงุช ู ูพุดุชุจุงู
                            </h2>
                            <p class="text-gray-600">ูพุงุณุฎ ุจู ุณูุงูุงุช ุฏุงูุดโุขููุฒุงู ู ุงุฑุงุฆู ูพุดุชุจุงู</p>
                        </div>
                    </div>
                    <div id="questions-support-content">
                        <!-- Questions content will be loaded here -->
                    </div>
                </div>

                <!-- Cancelled Classes -->
                <div id="cancelled-classes-content" class="hidden">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                โ ฺฉูุงุณโูุง ูุบู ุดุฏู
                            </h2>
                            <p class="text-gray-600">ูุฏุฑุช ฺฉูุงุณโูุง ูุบู ุดุฏู ุชูุณุท ุฏุงูุดโุขููุฒุงู ู ูุนูู</p>
                        </div>
                    </div>
                    <div id="cancelled-classes-list">
                        <!-- Cancelled classes content will be loaded here -->
                    </div>
                </div>

                <!-- Homework Assignments -->
                <div id="homework-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ ุชฺฉุงูู
                            </h2>
                            <p class="text-gray-600">ูุฏุฑุช ุชฺฉุงูู ู ุงุฑุณุงูโูุง ุฏุงูุดโุขููุฒุงู</p>
                        </div>
                    </div>
                    <div id="homework-assignments-content">
                        <!-- Homework content will be loaded here -->
                    </div>
                </div>

                <!-- Test Classes -->
                <div id="test-classes-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ ฺฉูุงุณโูุง ุขุฒูุงุด
                            </h2>
                            <p class="text-gray-600">ูุฏุฑุช ฺฉูุงุณโูุง ุขุฒูุงุด ุฑุงฺฏุงู</p>
                        </div>
                    </div>
                    <div id="test-classes-management-content">
                        <!-- Test classes content will be loaded here -->
                    </div>
                </div>

                <!-- Calendar -->
                <div id="calendar-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ ุชููู ฺฉูุงุณโูุง
                            </h2>
                            <p class="text-gray-600">ูุดุงูุฏู ู ูุฏุฑุช ุชููู ฺฉูุงุณโูุง ุจุง Google Calendar</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="authenticateGoogleCalendar()" class="px-4 py-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors">
                                ๐ ุงุชุตุงู ุจู Google Calendar
                            </button>
                            <button onclick="refreshCalendar()" class="px-4 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors">
                                ๐ ุจุฑูุฒุฑุณุงู
                            </button>
                        </div>
                    </div>
                    <div id="calendar-management-content">
                        <!-- Calendar content will be loaded here -->
                    </div>
                </div>

                <!-- Payments & Finance -->
                <div id="payments-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ฐ ูพุฑุฏุงุฎุชโูุง ู ุงููุฑ ูุงู
                            </h2>
                            <p class="text-gray-600">ูพฺฏุฑ ูพุฑุฏุงุฎุชโูุง ู ุณูุงุจู ูุงู</p>
                        </div>
                    </div>
                    <div id="payments-finance-content">
                        <!-- Payments content will be loaded here -->
                    </div>
                </div>

                <!-- Analytics & Reports -->
                <div id="analytics-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ ุขูุงุฑ ู ฺฏุฒุงุฑุดโูุง
                            </h2>
                            <p class="text-gray-600">ูุดุงูุฏู ุขูุงุฑ ู ุชููุฏ ฺฏุฒุงุฑุดโูุง</p>
                        </div>
                    </div>
                    <div id="analytics-reports-content">
                        <!-- Analytics content will be loaded here -->
                    </div>
                </div>

                <!-- Notifications & Communications -->
                <div id="notifications-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                ๐ ุงุทูุงุนโุฑุณุงูโูุง ู ุงุฑุชุจุงุทุงุช
                            </h2>
                            <p class="text-gray-600">ูุฏุฑุช ุงุทูุงุนโุฑุณุงูโูุง ู ุงุฑุชุจุงุทุงุช</p>
                        </div>
                    </div>
                    <div id="notifications-communications-content">
                        <!-- Notifications content will be loaded here -->
                    </div>
                </div>

                <!-- Settings & Configuration -->
                <div id="settings-content" class="space-y-6 hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-pink-600 flex items-center gap-2 text-2xl font-bold">
                                โ๏ธ ุชูุธูุงุช ู ูพฺฉุฑุจูุฏ
                            </h2>
                            <p class="text-gray-600">ุชูุธูุงุช ุณุณุชู ู ุชุฑุฌุญุงุช</p>
                        </div>
                    </div>
                    <div id="settings-configuration-content">
                        <!-- Settings content will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let currentSection = 'dashboard';
        let currentStudentTab = 'all';
        let dashboardData = {};

        // Auto-refresh function
        function startAutoRefresh() {
            // Refresh data every 30 seconds
            setInterval(() => {
                const activeSection = document.querySelector('.tab-button.active')?.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                if (activeSection) {
                    console.log('Auto-refreshing data for section:', activeSection);
                    
                    // Show refresh indicator
                    showNotification('๐ ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ ุฏุงุฏูโูุง...', 'info', 2000);
                    
                    switch(activeSection) {
                        case 'students':
                            loadStudents();
                            break;
                        case 'classes':
                            loadClasses();
                            break;
                        case 'payments':
                            loadPayments();
                            break;
                        case 'test-classes':
                            loadTestClasses();
                            break;
                        case 'homework':
                            loadHomework();
                            break;
                        case 'questions':
                            loadQuestions();
                            break;
                        case 'dashboard':
                            loadDashboard();
                            break;
                    }
                }
            }, 30000); // 30 seconds
        }

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== Dashboard initializing... ===');
            
            // First, ensure tab functionality works
            console.log('=== Setting up tab functionality first ===');
            try {
                setActiveSection('dashboard');
                console.log('โ Initial tab setup completed');
            } catch (error) {
                console.error('โ Error in initial tab setup:', error);
            }
            
            // Then try other functions
            try {
            setCurrentDate();
                console.log('โ setCurrentDate completed');
            } catch (error) {
                console.error('โ Error in setCurrentDate:', error);
            }
            
            try {
            loadDashboard();
                console.log('โ loadDashboard completed');
            } catch (error) {
                console.error('โ Error in loadDashboard:', error);
            }
            
            try {
            setupMobileMenu();
                console.log('โ setupMobileMenu completed');
            } catch (error) {
                console.error('โ Error in setupMobileMenu:', error);
            }
            
            // Start auto-refresh
            startAutoRefresh();
            
            // Show welcome notification
            showNotification('ุฎูุด ุขูุฏุฏ! ุฏุงุดุจูุฑุฏ ุขูุงุฏู ุงุณุชูุงุฏู ุงุณุช.', 'info', 3000);
            
            console.log('=== Dashboard initialization complete ===');
        });

        function setCurrentDate() {
            const date = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = date.toLocaleDateString('fa-IR', options);
        }

        function setupMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileSidebar = document.getElementById('mobile-sidebar');
            
            mobileMenuBtn.addEventListener('click', function() {
                mobileSidebar.classList.remove('hidden');
            });

            mobileSidebar.addEventListener('click', function(e) {
                if (e.target === mobileSidebar) {
                    mobileSidebar.classList.add('hidden');
                }
            });
        }

        function closeMobileMenu() {
            document.getElementById('mobile-sidebar').classList.add('hidden');
        }

        function setActiveSection(section) {
            console.log('=== setActiveSection called with:', section, '===');
            
            // Hide all content sections
            const sections = ['dashboard', 'students', 'classes', 'cancelled-classes', 'questions', 'homework', 'test-classes', 'calendar', 'payments', 'analytics', 'notifications', 'settings'];
            console.log('Hiding all sections...');
            sections.forEach(s => {
                const element = document.getElementById(s + '-content');
                if (element) {
                    element.classList.add('hidden');
                    console.log('โ Hidden section:', s);
                } else {
                    console.warn('โ Section element not found:', s + '-content');
                }
            });

            // Show selected section
            console.log('Showing target section:', section);
            const targetElement = document.getElementById(section + '-content');
            if (targetElement) {
                targetElement.classList.remove('hidden');
                console.log('โ Section shown successfully:', section);
            } else {
                console.error('โ Section not found:', section + '-content');
                alert('ุฎุทุง: ุจุฎุด ููุฑุฏ ูุธุฑ ุงูุช ูุดุฏ: ' + section);
                return;
            }

            // Update navigation
            sections.forEach(s => {
                const navBtn = document.getElementById('nav-' + s);
                const mobileNavBtn = document.getElementById('mobile-nav-' + s);
                if (navBtn) {
                    navBtn.classList.remove('bg-gradient-to-r', 'from-pink-200', 'to-purple-200', 'text-pink-700', 'shadow-md', 'scale-105');
                    navBtn.classList.add('hover:bg-pink-50', 'text-gray-600', 'hover:scale-102');
                }
                if (mobileNavBtn) {
                    mobileNavBtn.classList.remove('bg-gradient-to-r', 'from-pink-200', 'to-purple-200', 'text-pink-700', 'shadow-md', 'scale-105');
                    mobileNavBtn.classList.add('hover:bg-pink-50', 'text-gray-600', 'hover:scale-102');
                }
            });

            const activeNavBtn = document.getElementById('nav-' + section);
            const activeMobileNavBtn = document.getElementById('mobile-nav-' + section);
            if (activeNavBtn) {
                activeNavBtn.classList.add('bg-gradient-to-r', 'from-pink-200', 'to-purple-200', 'text-pink-700', 'shadow-md', 'scale-105');
                activeNavBtn.classList.remove('hover:bg-pink-50', 'text-gray-600', 'hover:scale-102');
            }
            if (activeMobileNavBtn) {
                activeMobileNavBtn.classList.add('bg-gradient-to-r', 'from-pink-200', 'to-purple-200', 'text-pink-700', 'shadow-md', 'scale-105');
                activeMobileNavBtn.classList.remove('hover:bg-pink-50', 'text-gray-600', 'hover:scale-102');
            }

            currentSection = section;

            // Load section-specific data (only if functions exist)
            try {
                if (section === 'dashboard' && typeof loadDashboard === 'function') {
                loadDashboard();
                } else if (section === 'students' && typeof loadStudents === 'function') {
                loadStudents();
                } else if (section === 'classes' && typeof loadClasses === 'function') {
                loadClasses();
                } else if (section === 'cancelled' && typeof loadCancelledClasses === 'function') {
                loadCancelledClasses();
                } else if (section === 'questions' && typeof loadQuestions === 'function') {
                loadQuestions();
                } else if (section === 'homework' && typeof loadHomework === 'function') {
                loadHomework();
                } else if (section === 'test-classes' && typeof loadTestClasses === 'function') {
                loadTestClasses();
                } else if (section === 'calendar' && typeof loadCalendar === 'function') {
                loadCalendar();
                } else if (section === 'payments' && typeof loadPayments === 'function') {
                loadPayments();
                } else if (section === 'analytics' && typeof loadAnalytics === 'function') {
                loadAnalytics();
                } else if (section === 'notifications' && typeof loadNotifications === 'function') {
                loadNotifications();
                } else if (section === 'settings' && typeof loadSettings === 'function') {
                loadSettings();
                }
            } catch (error) {
                console.error('Error loading section data:', error);
                // Don't show error alert for missing functions, just log it
                console.warn('Section data loading failed for:', section, error.message);
            }
        }

        function setStudentTab(tab) {
            // Update tab buttons
            const tabs = ['all', 'approved', 'pending', 'existing-pending'];
            tabs.forEach(t => {
                const tabBtn = document.getElementById('tab-' + t);
                if (tabBtn) {
                    tabBtn.classList.remove('bg-white', 'text-pink-600');
                    tabBtn.classList.add('text-gray-600');
                }
            });

            const activeTabBtn = document.getElementById('tab-' + tab);
            if (activeTabBtn) {
                activeTabBtn.classList.add('bg-white', 'text-pink-600');
                activeTabBtn.classList.remove('text-gray-600');
            }

            currentStudentTab = tab;
            loadStudents();
        }

        async function loadDashboard() {
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();
                
                console.log('Dashboard API Response:', data);
                
                if (data && data.students) {
                    dashboardData = data;
                    
                    // Show data loaded notification
                    showNotification(`โ ุฏุงุฏูโูุง ุจุงุฑฺฏุฐุงุฑ ุดุฏูุฏ (${data.students.length} ุฏุงูุดโุขููุฒ)`, 'success', 2000);
                    
                    // Add some sample data if no data exists
                    if (data.students.length === 0) {
                        dashboardData.students = [
                            {
                                id: 1,
                                name: 'ุณุงุฑุง ุงุญูุฏ',
                                phoneNumber: '09123456789',
                                email: 'sara@example.com',
                                registrationStatus: 'pending',
                                classType: 'test',
                                selectedTime: '14:00',
                                message: 'ุนูุงููโููุฏ ุจู ุงุฏฺฏุฑ ูุฑุงูุณู',
                                createdAt: new Date().toISOString()
                            },
                            {
                                id: 2,
                                name: 'ุนู ุฑุถุง',
                                phoneNumber: '09987654321',
                                email: 'ali@example.com',
                                registrationStatus: 'approved',
                                classType: 'private',
                                level: 'A1',
                                sessionsLeft: 8,
                                paymentStatus: 'paid',
                                classes: [
                                    {
                                        id: 1,
                                        date: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                                        time: '16:00',
                                        status: 'scheduled',
                                        student: { name: 'ุนู ุฑุถุง' }
                                    }
                                ]
                            }
                        ];
                        dashboardData.upcomingClasses = dashboardData.students.flatMap(s => s.classes || []);
                    }
                    
                    // Calculate stats from actual data
                    const stats = {
                        totalStudents: data.students.length,
                        approvedStudents: data.students.filter(s => s.registrationStatus === 'approved').length,
                        pendingStudents: data.students.filter(s => s.registrationStatus === 'pending').length,
                        existingPendingStudents: data.students.filter(s => s.registrationStatus === 'existing_pending').length,
                        testClassRequests: data.students.filter(s => s.registrationStatus === 'pending' && s.classType === 'test').length,
                        upcomingClasses: data.upcomingClasses ? data.upcomingClasses.length : 0,
                        unansweredQuestions: data.recentQuestions ? data.recentQuestions.length : 0,
                        homeworkSubmissions: data.homeworkSubmissions ? data.homeworkSubmissions.length : 0
                    };
                    
                    updateStats(stats);
                    updateUpcomingClasses(data.upcomingClasses || []);
                    updateRecentQuestions(data.recentQuestions || []);
                    updateHomeworkSubmissions(data.homeworkSubmissions || []);
                    updateTodaysTasks(data.todaysTasks || []);
                } else {
                    console.error('Invalid API response:', data);
                    showError('ุฏุงุฏูโูุง ูุงูุนุชุจุฑ ุงุฒ ุณุฑูุฑ ุฏุฑุงูุช ุดุฏ');
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showError('ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุฏุงุดุจูุฑุฏ: ' + error.message);
            }
        }

        function updateStats(stats) {
            const statsContainer = document.getElementById('stats-container');
            const statsData = [
                { label: "ฺฉู ุฏุงูุดโุขููุฒุงู", value: stats.totalStudents || 0, color: "from-pink-400 to-rose-400", bgColor: "bg-pink-50", icon: "๐ฅ" },
                { label: "ุฏุงูุดโุขููุฒุงู ุชุฃุฏ ุดุฏู", value: stats.approvedStudents || 0, color: "from-green-400 to-emerald-400", bgColor: "bg-green-50", icon: "โ" },
                { label: "ุฏุฑ ุงูุชุธุงุฑ ุชุฃุฏ", value: stats.pendingStudents || 0, color: "from-orange-400 to-yellow-400", bgColor: "bg-orange-50", icon: "โณ" },
                { label: "ุฏุฑ ุงูุชุธุงุฑ ููุฌูุฏ", value: stats.existingPendingStudents || 0, color: "from-purple-400 to-pink-400", bgColor: "bg-purple-50", icon: "๐" },
                { label: "ุฏุฑุฎูุงุณุช ฺฉูุงุณ ุขุฒูุงุด", value: stats.testClassRequests || 0, color: "from-blue-400 to-indigo-400", bgColor: "bg-blue-50", icon: "๐" },
                { label: "ฺฉูุงุณโูุง ูพุด ุฑู", value: stats.upcomingClasses || 0, color: "from-teal-400 to-cyan-400", bgColor: "bg-teal-50", icon: "๐" },
                { label: "ุณูุงูุงุช ุจโูพุงุณุฎ", value: stats.unansweredQuestions || 0, color: "from-rose-400 to-red-400", bgColor: "bg-rose-50", icon: "โ" },
                { label: "ุงุฑุณุงูโูุง ุชฺฉูู", value: stats.homeworkSubmissions || 0, color: "from-violet-400 to-purple-400", bgColor: "bg-violet-50", icon: "๐" }
            ];

            statsContainer.innerHTML = statsData.map(stat => `
                <div class="${stat.bgColor} border border-pink-200 rounded-xl shadow-lg hover:shadow-xl transition-all hover:scale-105">
                    <div class="p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 bg-gradient-to-br ${stat.color} rounded-2xl flex items-center justify-center shadow-md">
                                <span class="text-2xl">${stat.icon}</span>
                </div>
                            <div>
                                <p class="text-sm text-gray-600 mb-1">${stat.label}</p>
                                <p class="text-pink-600 text-xl font-bold">${stat.value}</p>
                </div>
                </div>
                </div>
            </div>
            `).join('');
        }

        function updateUpcomingClasses(classes) {
            const container = document.getElementById('upcoming-classes');
            if (classes.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">ฺฉูุงุณ ูพุด ุฑู ูุฌูุฏ ูุฏุงุฑุฏ</p>';
                return;
            }

            // Sort classes by date and time
            const sortedClasses = classes.sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                if (dateA.getTime() === dateB.getTime()) {
                    return a.time.localeCompare(b.time);
                }
                return dateA.getTime() - dateB.getTime();
            });

            container.innerHTML = sortedClasses.map(cls => {
                const isCancelled = ['cancelled', 'cancelled_by_student', 'cancelled_by_teacher'].includes(cls.status);
                const paymentStatus = cls.student ? cls.student.paymentStatus : 'unpaid';
                const classDate = new Date(cls.date);
                const today = new Date();
                const isToday = classDate.toDateString() === today.toDateString();
                const isTomorrow = classDate.toDateString() === new Date(today.getTime() + 24 * 60 * 60 * 1000).toDateString();
                
                let bgColor, borderColor, textColor, statusIcon, statusText;
                
                if (isCancelled) {
                    bgColor = 'from-red-50 to-pink-50';
                    borderColor = 'border-red-200';
                    textColor = 'text-red-700';
                    statusIcon = 'โ';
                    statusText = 'ูุบู ุดุฏู';
                } else if (isToday) {
                    bgColor = 'from-blue-50 to-indigo-50';
                    borderColor = 'border-blue-200';
                    textColor = 'text-blue-700';
                    statusIcon = '๐';
                    statusText = 'ุงูุฑูุฒ';
                } else if (isTomorrow) {
                    bgColor = 'from-green-50 to-emerald-50';
                    borderColor = 'border-green-200';
                    textColor = 'text-green-700';
                    statusIcon = 'โฐ';
                    statusText = 'ูุฑุฏุง';
                } else {
                    bgColor = 'from-pink-50 to-purple-50';
                    borderColor = 'border-pink-200';
                    textColor = 'text-gray-700';
                    statusIcon = '๐';
                    statusText = classDate.toLocaleDateString('fa-IR');
                }
                
                const paymentIcon = paymentStatus === 'paid' ? 'โ' : '๐ฐ';
                const classTypeText = cls.classType === 'group' ? 'ฺฏุฑูู' : cls.classType === 'test' ? 'ุขุฒูุงุด' : 'ุฎุตูุต';
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r ${bgColor} border ${borderColor} rounded-2xl hover:shadow-md transition-all">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-pink-300 to-purple-300 rounded-full flex items-center justify-center text-white font-bold overflow-hidden">
                                <img id="upcoming-photo-${cls.student ? cls.student.id : 'unknown'}" 
                                     src="" 
                                     alt="${cls.studentName || 'ูุงูุดุฎุต'}" 
                                     class="w-full h-full object-cover rounded-full hidden"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <span id="upcoming-initial-${cls.student ? cls.student.id : 'unknown'}" class="w-full h-full flex items-center justify-center">
                                    ${cls.studentName ? cls.studentName.charAt(0) : '?'}
                                </span>
                            </div>
                            <div>
                                <p class="text-gray-800 font-medium">${cls.studentName || 'ุฏุงูุดโุขููุฒ ูุงูุดุฎุต'}</p>
                                <p class="text-sm text-gray-500">${statusText} ุฏุฑ ${cls.time}</p>
                                <p class="text-xs text-gray-400">${classTypeText} ${cls.groupId ? `- ฺฏุฑูู ${cls.groupId}` : ''}</p>
                            </div>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">${statusIcon}</span>
                                <span class="text-lg">${paymentIcon}</span>
                            </div>
                            <span class="bg-pink-200 text-pink-700 px-3 py-1 rounded-full text-sm font-medium">
                                ${cls.level || 'ูุงูุดุฎุต'}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Load photos for upcoming class students
            classes.forEach(cls => {
                if (cls.student && cls.student.id) {
                    loadStudentPhoto(cls.student.id, `upcoming-photo-${cls.student.id}`, `upcoming-initial-${cls.student.id}`);
                }
            });
        }

        function updateRecentQuestions(questions) {
            const container = document.getElementById('recent-questions');
            if (questions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">ุณูุงู ุงุฎุฑ ูุฌูุฏ ูุฏุงุฑุฏ</p>';
                return;
            }

            container.innerHTML = questions.map(q => `
                <div class="p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl hover:shadow-md transition-all">
                    <div class="flex items-center justify-between mb-2">
                        <p class="text-purple-600 font-medium">${q.studentName || 'ุฏุงูุดโุขููุฒ ูุงูุดุฎุต'}</p>
                        <span class="text-xs text-gray-500">${q.timeAgo || 'ุฒูุงู ูุงูุดุฎุต'}</span>
            </div>
                    <p class="text-sm text-gray-700">${q.question || 'ูุชู ุณูุงู ููุฌูุฏ ูุณุช'}</p>
        </div>
            `).join('');
        }

        function updateHomeworkSubmissions(homework) {
            const container = document.getElementById('homework-submissions');
            if (homework.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">ุงุฑุณุงู ุชฺฉูู ูุฌูุฏ ูุฏุงุฑุฏ</p>';
                return;
            }

            container.innerHTML = homework.map(hw => `
                <div class="p-4 bg-gradient-to-br from-rose-50 to-pink-50 rounded-2xl hover:shadow-md transition-all">
                    <div class="flex items-center justify-between mb-2">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${hw.status === 'pending' ? 'bg-orange-200 text-orange-700' : 'bg-green-200 text-green-700'}">
                            ${hw.status === 'pending' ? 'โณ ุฏุฑ ุงูุชุธุงุฑ' : 'โ ุจุฑุฑุณ ุดุฏู'}
                        </span>
                        <span class="text-xs text-gray-500">${hw.submitted || 'ุฒูุงู ูุงูุดุฎุต'}</span>
            </div>
                    <p class="text-rose-600 font-medium mb-1">${hw.studentName || 'ุฏุงูุดโุขููุฒ ูุงูุดุฎุต'}</p>
                    <p class="text-sm text-gray-700">${hw.title || 'ุจุฏูู ุนููุงู'}</p>
        </div>
            `).join('');
        }

        function updateTodaysTasks(tasks) {
            const container = document.getElementById('todays-tasks');
            const defaultTasks = [
                'ุชุฃุฏ ุซุจุชโูุงูโูุง ุฏุฑ ุงูุชุธุงุฑ ุฏุงูุดโุขููุฒุงู',
                'ูพุงุณุฎ ุจู ุณูุงูุงุช ุจโูพุงุณุฎ',
                'ุจุฑุฑุณ ุงุฑุณุงูโูุง ุชฺฉูู',
                'ุจุฑูุงููโุฑุฒ ฺฉูุงุณโูุง ุขุฒูุงุด'
            ];

            const taskList = tasks.length > 0 ? tasks : defaultTasks;
            container.innerHTML = taskList.map(task => `
                <li class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-purple-400 rounded-full"></span>
                    ${task}
                </li>
            `).join('');
        }

        async function loadStudents() {
            console.log('Loading students...');
            try {
                if (dashboardData.students) {
                    console.log('Using cached student data');
                    updateStudentStats();
                    updateStudentsTable();
                } else {
                    console.log('Loading fresh dashboard data');
                    await loadDashboard();
                    if (dashboardData.students) {
                        updateStudentStats();
                        updateStudentsTable();
                    }
                }
                
                // Load photos for each student
                if (dashboardData.students) {
                    dashboardData.students.forEach(student => {
                        loadStudentPhoto(student.id);
                    });
                }
                
                console.log('Students loaded successfully');
            } catch (error) {
                console.error('Error loading students:', error);
                showError('ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุฏุงูุดโุขููุฒุงู');
            }
        }

        // Load student photo from Telegram
        async function loadStudentPhoto(studentId, photoId = null, initialId = null) {
            try {
                const response = await fetch(`/api/students/${studentId}/photo`);
                const data = await response.json();
                
                if (data.success && data.hasPhoto && data.photoUrl) {
                    const photoImgId = photoId || `student-photo-${studentId}`;
                    const initialSpanId = initialId || `student-initial-${studentId}`;
                    
                    const photoImg = document.getElementById(photoImgId);
                    const initialSpan = document.getElementById(initialSpanId);
                    
                    if (photoImg && initialSpan) {
                        photoImg.src = data.photoUrl;
                        photoImg.classList.remove('hidden');
                        initialSpan.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error(`Error loading photo for student ${studentId}:`, error);
            }
        }

        function updateStudentStats() {
            const students = dashboardData.students || [];
            const stats = {
                approved: students.filter(s => s.registrationStatus === 'approved').length,
                pending: students.filter(s => s.registrationStatus === 'pending').length,
                existingPending: students.filter(s => s.registrationStatus === 'existing_pending').length,
                total: students.length
            };

            const container = document.getElementById('student-stats');
            container.innerHTML = `
                <div class="bg-green-50 border border-pink-200 rounded-xl shadow-lg hover:shadow-xl transition-all">
                    <div class="p-6">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-400 rounded-2xl flex items-center justify-center">
                                <span class="text-xl">โ</span>
                        </div>
                            <div>
                                <p class="text-sm text-gray-600">ุชุฃุฏ ุดุฏู</p>
                                <p class="text-green-600 text-xl font-bold">${stats.approved}</p>
                    </div>
                        </div>
                        </div>
                        </div>
                <div class="bg-orange-50 border border-pink-200 rounded-xl shadow-lg hover:shadow-xl transition-all">
                    <div class="p-6">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-yellow-400 rounded-2xl flex items-center justify-center">
                                <span class="text-xl">โณ</span>
                        </div>
                            <div>
                                <p class="text-sm text-gray-600">ุฏุฑ ุงูุชุธุงุฑ</p>
                                <p class="text-orange-600 text-xl font-bold">${stats.pending}</p>
                        </div>
                        </div>
                    </div>
                    </div>
                <div class="bg-purple-50 border border-pink-200 rounded-xl shadow-lg hover:shadow-xl transition-all">
                    <div class="p-6">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-2xl flex items-center justify-center">
                                <span class="text-xl">๐</span>
                </div>
                            <div>
                                <p class="text-sm text-gray-600">ุฏุฑ ุงูุชุธุงุฑ ููุฌูุฏ</p>
                                <p class="text-purple-600 text-xl font-bold">${stats.existingPending}</p>
                </div>
                        </div>
                    </div>
                </div>
                <div class="bg-pink-50 border border-pink-200 rounded-xl shadow-lg hover:shadow-xl transition-all">
                    <div class="p-6">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-pink-400 to-rose-400 rounded-2xl flex items-center justify-center">
                                <span class="text-xl">๐ฅ</span>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">ฺฉู ุฏุงูุดโุขููุฒุงู</p>
                                <p class="text-pink-600 text-xl font-bold">${stats.total}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateStudentsTable() {
            const students = dashboardData.students || [];
            let filteredStudents = students;
            
            if (currentStudentTab === 'approved') {
                filteredStudents = students.filter(s => s.registrationStatus === 'approved');
            } else if (currentStudentTab === 'pending') {
                filteredStudents = students.filter(s => s.registrationStatus === 'pending');
            } else if (currentStudentTab === 'existing-pending') {
                filteredStudents = students.filter(s => s.registrationStatus === 'existing_pending');
            }

            const container = document.getElementById('students-table-body');
            if (filteredStudents.length === 0) {
                container.innerHTML = '<tr><td colspan="8" class="text-center py-8 text-gray-500">ุฏุงูุดโุขููุฒ ุงูุช ูุดุฏ</td></tr>';
                return;
            }

            container.innerHTML = filteredStudents.map(student => `
                <tr class="border-b border-pink-200 hover:bg-pink-50 transition-colors">
                    <td class="py-4 px-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-pink-300 to-purple-300 rounded-full flex items-center justify-center text-white font-bold overflow-hidden">
                                <img id="student-photo-${student.id}" 
                                     src="" 
                                     alt="${student.name}" 
                                     class="w-full h-full object-cover rounded-full hidden"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <span id="student-initial-${student.id}" class="w-full h-full flex items-center justify-center">
                                    ${student.name ? student.name.charAt(0) : '?'}
                                </span>
                        </div>
                            <div>
                                <p class="font-medium">${student.name || 'ูุงูุดุฎุต'}</p>
                                <p class="text-xs text-gray-500">${student.telegramId || 'N/A'}</p>
                </div>
                    </div>
                    </td>
                    <td class="py-4 px-4">
                        <div class="text-sm">
                            <p>${student.phoneNumber || 'N/A'}</p>
                            <p class="text-gray-500">${student.city || 'N/A'}</p>
                    </div>
                    </td>
                    <td class="py-4 px-4">
                        <span class="bg-pink-200 text-pink-700 px-2 py-1 rounded-full text-xs font-medium">
                            ${student.level || 'ูุงูุดุฎุต'}
                        </span>
                    </td>
                    <td class="py-4 px-4">${student.classType === 'private' ? 'ุฎุตูุต' : 'ฺฏุฑูู'}</td>
                    <td class="py-4 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${student.sessionsLeft === 0 ? 'bg-red-200 text-red-700' : 'bg-blue-200 text-blue-700'}">
                            ${student.sessionsLeft || 0} ุจุงูโูุงูุฏู
                        </span>
                    </td>
                    <td class="py-4 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getPaymentColor(student.paymentStatus)}">
                            ${getPaymentText(student.paymentStatus)}
                        </span>
                    </td>
                    <td class="py-4 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getClassTypeColor(student.classType)}">
                            ${getClassTypeText(student.classType)}
                        </span>
                        ${student.groupId ? `<div class="text-xs text-gray-500 mt-1">ฺฏุฑูู: ${student.groupId}</div>` : ''}
                    </td>
                    <td class="py-4 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(student.registrationStatus)}">
                            ${getStatusText(student.registrationStatus)}
                        </span>
                    </td>
                    <td class="py-4 px-4">
                        ${student.paymentStatus === 'unpaid' || student.paymentStatus === 'overdue' ? 
                            `<button onclick="showPaymentReminderModal(${student.id}, '${student.name}')" class="px-3 py-1 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors text-sm font-medium">
                                ๐ฐ ุงุฏุขูุฑ ูพุฑุฏุงุฎุช
                            </button>` : 
                            '<span class="text-gray-400 text-sm">ูพุฑุฏุงุฎุช ุดุฏู</span>'
                        }
                    </td>
                    <td class="py-4 px-4">
                        <div class="flex gap-2">
                            <button onclick="viewStudentDetails(${student.id})" class="p-2 border border-pink-300 text-pink-600 hover:bg-pink-50 rounded-xl transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                            <button onclick="editStudent(${student.id})" class="p-2 border border-blue-300 text-blue-600 hover:bg-blue-50 rounded-xl transition-colors" title="ูุฑุงุด ุฏุงูุดโุขููุฒ">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="rejectStudent(${student.id})" class="p-2 bg-red-500 text-white hover:bg-red-600 rounded-xl transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                </div>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusColor(status) {
            switch (status) {
                case "approved":
                    return "bg-green-200 text-green-700";
                case "pending":
                    return "bg-orange-200 text-orange-700";
                case "existing_pending":
                    return "bg-purple-200 text-purple-700";
                case "rejected":
                    return "bg-red-200 text-red-700";
                default:
                    return "bg-gray-200 text-gray-700";
            }
        }

        function getStatusText(status) {
            switch (status) {
                case "approved":
                    return "ุชุฃุฏ ุดุฏู";
                case "pending":
                    return "ุฏุฑ ุงูุชุธุงุฑ";
                case "existing_pending":
                    return "ุฏุฑ ุงูุชุธุงุฑ ููุฌูุฏ";
                case "rejected":
                    return "ุฑุฏ ุดุฏู";
                default:
                    return "ูุงูุดุฎุต";
            }
        }

        function getPaymentColor(status) {
            switch (status) {
                case "paid":
                    return "bg-green-200 text-green-700";
                case "unpaid":
                    return "bg-yellow-200 text-yellow-700";
                case "overdue":
                    return "bg-red-200 text-red-700";
                default:
                    return "bg-gray-200 text-gray-700";
            }
        }

        function getPaymentText(status) {
            switch (status) {
                case "paid":
                    return "ูพุฑุฏุงุฎุช ุดุฏู";
                case "unpaid":
                    return "ูพุฑุฏุงุฎุช ูุดุฏู";
                case "overdue":
                    return "ูุนูู";
                default:
                    return "ูุงูุดุฎุต";
            }
        }

        function viewStudentDetails(studentId) {
            const student = dashboardData.students?.find(s => s.id === studentId);
            if (!student) {
                showNotification('โ ุฏุงูุดโุขููุฒ ุงูุช ูุดุฏ', 'error');
                return;
            }

            const isTestClass = student.classType === 'test';
            const content = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Basic Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ุงุทูุงุนุงุช ุดุฎุต</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ูุงู ฺฉุงูู:</span>
                                <span class="text-gray-800">${student.name || 'ูุงูุดุฎุต'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุดูุงุฑู ุชููู:</span>
                                <span class="text-gray-800">${student.phoneNumber || 'ูุงูุดุฎุต'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุงูู:</span>
                                <span class="text-gray-800">${student.email || 'ูุงูุดุฎุต'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุดูุฑ:</span>
                                <span class="text-gray-800">${student.city || 'ูุงูุดุฎุต'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุชุงุฑุฎ ุชููุฏ:</span>
                                <span class="text-gray-800">${student.birthDate || 'ูุงูุดุฎุต'}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Academic Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ุงุทูุงุนุงุช ุชุญุตู</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ููุน ฺฉูุงุณ:</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${isTestClass ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
                                    ${isTestClass ? 'ฺฉูุงุณ ุขุฒูุงุด' : student.classType === 'private' ? 'ุฎุตูุต' : 'ฺฏุฑูู'}
                                </span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุณุทุญ:</span>
                                <span class="text-gray-800">${student.level || 'ูุงูุดุฎุต'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุฌูุณุงุช ุจุงูโูุงูุฏู:</span>
                                <span class="text-gray-800">${student.sessionsLeft || 0}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุฌูุณุงุช ุฏุฑ ููุชู:</span>
                                <span class="text-gray-800">${student.sessionsPerWeek || 'ูุงูุดุฎุต'}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุฑูุฒูุง ฺฉูุงุณ:</span>
                                <span class="text-gray-800">${student.selectedDays || 'ูุงูุดุฎุต'}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Status Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ูุถุนุช</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ูุถุนุช ุซุจุชโูุงู:</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(student.registrationStatus)}">
                                    ${getStatusText(student.registrationStatus)}
                                </span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ูุถุนุช ูพุฑุฏุงุฎุช:</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${getPaymentColor(student.paymentStatus)}">
                                    ${getPaymentText(student.paymentStatus)}
                                </span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุชุงุฑุฎ ุซุจุชโูุงู:</span>
                                <span class="text-gray-800">${new Date(student.createdAt).toLocaleDateString('fa-IR')}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="font-medium text-gray-600">ุขุฎุฑู ุจุฑูุฒุฑุณุงู:</span>
                                <span class="text-gray-800">${new Date(student.updatedAt).toLocaleDateString('fa-IR')}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ุงุทูุงุนุงุช ุงุถุงู</h4>
                        <div class="space-y-3">
                            <div>
                                <span class="font-medium text-gray-600 block mb-1">ุฏูู ุงุฏฺฏุฑ:</span>
                                <p class="text-gray-800 text-sm bg-gray-50 p-2 rounded">${student.learningReason || 'ูุงูุดุฎุต'}</p>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600 block mb-1">ุชุฌุฑุจู ูุจู:</span>
                                <p class="text-gray-800 text-sm bg-gray-50 p-2 rounded">${student.experience || 'ูุงูุดุฎุต'}</p>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600 block mb-1">ุชูุถุญุงุช ุงุถุงู:</span>
                                <p class="text-gray-800 text-sm bg-gray-50 p-2 rounded">${student.additionalInfo || 'ูุงูุดุฎุต'}</p>
                            </div>
                        </div>
                    </div>
                </div>

                ${student.classes && student.classes.length > 0 ? `
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">ฺฉูุงุณโูุง ุจุฑูุงููโุฑุฒ ุดุฏู</h4>
                        <div class="space-y-2">
                            ${student.classes.map(cls => `
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <span class="font-medium">${cls.day}</span>
                                        <span class="text-gray-500 mr-2">${cls.time}</span>
                                    </div>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${cls.status === 'scheduled' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'}">
                                        ${cls.status === 'scheduled' ? 'ุจุฑูุงููโุฑุฒ ุดุฏู' : cls.status}
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;

            showViewModal({
                type: isTestClass ? 'test' : 'student',
                title: `ุฌุฒุฆุงุช ${isTestClass ? 'ฺฉูุงุณ ุขุฒูุงุด' : 'ุฏุงูุดโุขููุฒ'}`,
                subtitle: student.name,
                icon: isTestClass ? '๐' : '๐ค',
                content: content
            });
        }

        async function approveStudent(studentId) {
            // Find student data for display
            const student = dashboardData.students.find(s => s.id === studentId);
            
            showConfirmationModal({
                type: 'success',
                title: 'ุชุฃุฏ ุฏุงูุดโุขููุฒ',
                subtitle: 'ุซุจุชโูุงู ุฏุงูุดโุขููุฒ',
                message: 'ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ุฏุงูุดโุขููุฒ ุฑุง ุชุฃุฏ ฺฉูุฏุ',
                details: student ? `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-medium">ูุงู ุฏุงูุดุฌู:</span>
                            <span>${student.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุดูุงุฑู ุชููู:</span>
                            <span>${student.phoneNumber || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุดูุฑ:</span>
                            <span>${student.city || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุณุทุญ:</span>
                            <span>${student.level || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ููุน ฺฉูุงุณ:</span>
                            <span>${student.classType === 'private' ? 'ุฎุตูุต' : 'ฺฏุฑูู'}</span>
                        </div>
                    </div>
                ` : '',
                confirmText: 'ุชุฃุฏ ุฏุงูุดโุขููุฒ',
                onConfirm: async () => {
                    try {
                        showNotification('ุฏุฑ ุญุงู ุชุฃุฏ ุฏุงูุดโุขููุฒ...', 'info', 0);
                        
                const response = await fetch(`/api/students/${studentId}/approve`, {
                    method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                sessionsLeft: 10,
                                sessionsPerWeek: 2,
                                selectedDays: ['ุฏูุดูุจู', 'ฺูุงุฑุดูุจู'],
                                classTimes: [
                                    { day: 'ุฏูุดูุจู', time: '16:00' },
                                    { day: 'ฺูุงุฑุดูุจู', time: '16:00' }
                                ],
                                paymentStatus: 'unpaid'
                            })
                });
                
                if (response.ok) {
                            showNotification('โ ุฏุงูุดโุขููุฒ ุจุง ููููุช ุชุฃุฏ ุดุฏ! ูพุงู ุชุฃุฏ ุงุฑุณุงู ุดุฏ.', 'success');
                        loadStudents();
                } else {
                            showNotification('โ ุฎุทุง ุฏุฑ ุชุฃุฏ ุฏุงูุดโุขููุฒ', 'error');
                }
            } catch (error) {
                console.error('Error approving student:', error);
                        showNotification('โ ุฎุทุง ุฏุฑ ุชุฃุฏ ุฏุงูุดโุขููุฒ', 'error');
                }
            }
            });
        }

        async function rejectStudent(studentId) {
            // Find student data for display
            const student = dashboardData.students.find(s => s.id === studentId);
            
            showConfirmationModal({
                type: 'error',
                title: 'ุฑุฏ ฺฉุฑุฏู ุฏุงูุดโุขููุฒ',
                subtitle: 'ุซุจุชโูุงู ุฏุงูุดโุขููุฒ',
                message: 'ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ุฏุงูุดโุขููุฒ ุฑุง ุฑุฏ ฺฉูุฏุ',
                details: student ? `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-medium">ูุงู ุฏุงูุดุฌู:</span>
                            <span>${student.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุดูุงุฑู ุชููู:</span>
                            <span>${student.phoneNumber || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุดูุฑ:</span>
                            <span>${student.city || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุณุทุญ:</span>
                            <span>${student.level || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ููุน ฺฉูุงุณ:</span>
                            <span>${student.classType === 'private' ? 'ุฎุตูุต' : 'ฺฏุฑูู'}</span>
                        </div>
                    </div>
                ` : '',
                confirmText: 'ุฑุฏ ฺฉุฑุฏู ุฏุงูุดโุขููุฒ',
                onConfirm: async () => {
                    try {
                        showNotification('ุฏุฑ ุญุงู ุฑุฏ ฺฉุฑุฏู ุฏุงูุดโุขููุฒ...', 'info', 0);
                        
                const response = await fetch(`/api/students/${studentId}/reject`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                            showNotification('โ ุฏุงูุดโุขููุฒ ุฑุฏ ุดุฏ. ูพุงู ุฑุฏ ุดุฏู ุงุฑุณุงู ุดุฏ.', 'warning');
                        loadStudents();
                } else {
                            showNotification('โ ุฎุทุง ุฏุฑ ุฑุฏ ฺฉุฑุฏู ุฏุงูุดโุขููุฒ', 'error');
                }
            } catch (error) {
                console.error('Error rejecting student:', error);
                        showNotification('โ ุฎุทุง ุฏุฑ ุฑุฏ ฺฉุฑุฏู ุฏุงูุดโุขููุฒ', 'error');
                }
            }
            });
        }

        // Load other sections
        async function loadClasses() {
            try {
                const container = document.getElementById('classes-schedule-content');
                container.innerHTML = '<p class="text-center py-8 text-gray-500">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</p>';
                
                // Get upcoming classes from dashboard data
                const upcomingClasses = dashboardData.upcomingClasses || [];
                
                // Group classes by month
                const classesByMonth = {};
                upcomingClasses.forEach(cls => {
                    const date = new Date(cls.date);
                    const monthKey = `${date.getFullYear()}-${date.getMonth()}`;
                    if (!classesByMonth[monthKey]) {
                        classesByMonth[monthKey] = [];
                    }
                    classesByMonth[monthKey].push(cls);
                });
                
                // Get current month
                const now = new Date();
                const currentMonth = `${now.getFullYear()}-${now.getMonth()}`;
                
                container.innerHTML = `
                    <div class="space-y-6">
                        <!-- Calendar Navigation -->
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-800">ุชููู ฺฉูุงุณโูุง</h3>
                            <div class="flex items-center gap-2">
                                <button onclick="previousMonth()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                </button>
                                <span id="current-month-display" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-medium">
                                    ${now.toLocaleDateString('fa-IR', { year: 'numeric', month: 'long' })}
                                </span>
                                <button onclick="nextMonth()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Calendar Grid -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <!-- Payment Status Legend -->
                            <div class="flex items-center justify-center gap-6 mb-4 p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 bg-green-100 border border-green-300 rounded"></div>
                                    <span class="text-sm text-gray-700">โ ูพุฑุฏุงุฎุช ุดุฏู</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 bg-yellow-100 border border-yellow-300 rounded"></div>
                                    <span class="text-sm text-gray-700">๐ฐ ูพุฑุฏุงุฎุช ูุดุฏู</span>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-7 gap-2 mb-4">
                                <div class="text-center font-semibold text-gray-600 py-2">ุดูุจู</div>
                                <div class="text-center font-semibold text-gray-600 py-2">ฺฉุดูุจู</div>
                                <div class="text-center font-semibold text-gray-600 py-2">ุฏูุดูุจู</div>
                                <div class="text-center font-semibold text-gray-600 py-2">ุณูโุดูุจู</div>
                                <div class="text-center font-semibold text-gray-600 py-2">ฺูุงุฑุดูุจู</div>
                                <div class="text-center font-semibold text-gray-600 py-2">ูพูุฌโุดูุจู</div>
                                <div class="text-center font-semibold text-gray-600 py-2">ุฌูุนู</div>
                            </div>
                            <div id="calendar-grid" class="grid grid-cols-7 gap-2">
                                ${generateCalendarGrid(now, classesByMonth[currentMonth] || [])}
                            </div>
                        </div>
                        
                        <!-- Upcoming Classes List -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">ฺฉูุงุณโูุง ุขูุฏู</h4>
                            <div class="space-y-3">
                                ${upcomingClasses.length === 0 ? 
                                    '<p class="text-center py-4 text-gray-500">ฺฉูุงุณ ุขูุฏูโุง ูุฌูุฏ ูุฏุงุฑุฏ</p>' :
                                    upcomingClasses.map(cls => `
                                        <div class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-white font-bold">
                                                    ${cls.student ? cls.student.name.charAt(0) : '?'}
                                                </div>
                                                <div>
                                                    <p class="font-medium text-gray-800">${cls.student ? cls.student.name : 'ูุงูุดุฎุต'}</p>
                                                    <p class="text-sm text-gray-600">${new Date(cls.date).toLocaleDateString('fa-IR')} - ${cls.time}</p>
                                                    <p class="text-xs text-gray-500">${cls.day}</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">
                                                    ${cls.status === 'scheduled' ? 'ุจุฑูุงููโุฑุฒ ุดุฏู' : cls.status}
                                                </span>
                                                <button onclick="viewClassDetails(${cls.id})" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors" title="ุฌุฒุฆุงุช ฺฉูุงุณ">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    `).join('')
                                }
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading classes:', error);
                document.getElementById('classes-schedule-content').innerHTML = '<p class="text-center py-8 text-red-500">ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ฺฉูุงุณโูุง</p>';
            }
        }

        async function loadCancelledClasses() {
            try {
                const response = await fetch('/api/cancelled-classes');
                const cancelledClasses = await response.json();
                
                dashboardData.cancelledClasses = cancelledClasses;
                updateCancelledClassesTable(cancelledClasses);
            } catch (error) {
                console.error('Error loading cancelled classes:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ฺฉูุงุณโูุง ูุบู ุดุฏู', 'error');
            }
        }

        // Update cancelled classes table
        function updateCancelledClassesTable(cancelledClasses) {
            const container = document.getElementById('cancelled-classes-list');
            if (!container) return;

            if (cancelledClasses.length === 0) {
                container.innerHTML = '<p class="text-center py-8 text-gray-500">ฺฉูุงุณ ูุบู ุดุฏูโุง ูุฌูุฏ ูุฏุงุฑุฏ</p>';
                return;
            }

            container.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-red-50">
                                <tr>
                                    <th class="px-6 py-4 text-right text-red-600 font-semibold">ุฏุงูุดโุขููุฒ</th>
                                    <th class="px-6 py-4 text-right text-red-600 font-semibold">ุชุงุฑุฎ ฺฉูุงุณ</th>
                                    <th class="px-6 py-4 text-right text-red-600 font-semibold">ุณุงุนุช</th>
                                    <th class="px-6 py-4 text-right text-red-600 font-semibold">ููุน ูุบู</th>
                                    <th class="px-6 py-4 text-right text-red-600 font-semibold">ุฏูู</th>
                                    <th class="px-6 py-4 text-right text-red-600 font-semibold">ุชุงุฑุฎ ูุบู</th>
                                    <th class="px-6 py-4 text-right text-red-600 font-semibold">ุนููุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="cancelled-classes-table-body">
                                ${cancelledClasses.map(cls => `
                                    <tr class="border-b border-red-200 hover:bg-red-50 transition-colors">
                                        <td class="py-4 px-6">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-gradient-to-br from-red-300 to-pink-300 rounded-full flex items-center justify-center text-white font-bold overflow-hidden">
                                                    <img id="cancelled-photo-${cls.student.id}" 
                                                         src="" 
                                                         alt="${cls.student.name}" 
                                                         class="w-full h-full object-cover rounded-full hidden"
                                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                    <span id="cancelled-initial-${cls.student.id}" class="w-full h-full flex items-center justify-center">
                                                        ${cls.student.name ? cls.student.name.charAt(0) : '?'}
                                                    </span>
                                                </div>
                                                <div>
                                                    <p class="font-medium">${cls.student.name || 'ูุงูุดุฎุต'}</p>
                                                    <p class="text-xs text-gray-500">${cls.student.phoneNumber || 'ุจุฏูู ุดูุงุฑู'}</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="py-4 px-6 text-sm text-gray-600">
                                            ${new Date(cls.date).toLocaleDateString('fa-IR')}
                                        </td>
                                        <td class="py-4 px-6 text-sm text-gray-600">
                                            ${cls.time}
                                        </td>
                                        <td class="py-4 px-6">
                                            <span class="px-2 py-1 rounded-full text-xs font-medium ${getCancellationTypeColor(cls.status)}">
                                                ${getCancellationTypeText(cls.status)}
                                            </span>
                                        </td>
                                        <td class="py-4 px-6 text-sm text-gray-600">
                                            ${cls.cancellationReason || 'ุจุฏูู ุฏูู'}
                                        </td>
                                        <td class="py-4 px-6 text-sm text-gray-600">
                                            ${cls.cancelledAt ? new Date(cls.cancelledAt).toLocaleDateString('fa-IR') : 'ูุงูุดุฎุต'}
                                        </td>
                                        <td class="py-4 px-6">
                                            <div class="flex gap-2">
                                                <button onclick="rescheduleClass(${cls.id})" class="p-2 border border-green-300 text-green-600 hover:bg-green-50 rounded-xl transition-colors">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Load photos for cancelled class students
            cancelledClasses.forEach(cls => {
                loadStudentPhoto(cls.student.id, `cancelled-photo-${cls.student.id}`, `cancelled-initial-${cls.student.id}`);
            });
        }

        // Get cancellation type color
        function getCancellationTypeColor(status) {
            switch (status) {
                case 'cancelled_by_student': return 'bg-yellow-100 text-yellow-800';
                case 'cancelled_by_teacher': return 'bg-red-100 text-red-800';
                case 'cancelled': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Get cancellation type text
        function getCancellationTypeText(status) {
            switch (status) {
                case 'cancelled_by_student': return 'ูุบู ุดุฏู ุชูุณุท ุฏุงูุดโุขููุฒ';
                case 'cancelled_by_teacher': return 'ูุบู ุดุฏู ุชูุณุท ูุนูู';
                case 'cancelled': return 'ูุบู ุดุฏู';
                default: return status;
            }
        }

        async function loadQuestions() {
            try {
                const response = await fetch('/api/questions');
                const questions = await response.json();
                
                dashboardData.questions = questions;
                updateQuestionsTable(questions);
            } catch (error) {
                console.error('Error loading questions:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุณูุงูุงุช', 'error');
            }
        }

        // Update questions table
        function updateQuestionsTable(questions) {
            const container = document.getElementById('questions-support-content');
            if (!container) return;

            if (questions.length === 0) {
                container.innerHTML = '<p class="text-center py-8 text-gray-500">ุณูุงู ูพุฑุณุฏู ูุดุฏู ุงุณุช</p>';
                return;
            }

            container.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-pink-50">
                                <tr>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ุฏุงูุดโุขููุฒ</th>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ุณูุงู</th>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ูุถุนุช</th>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ุชุงุฑุฎ</th>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ุนููุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="questions-table-body">
                                ${questions.map(q => `
                                    <tr class="border-b border-pink-200 hover:bg-pink-50 transition-colors">
                                        <td class="py-4 px-6">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-gradient-to-br from-pink-300 to-purple-300 rounded-full flex items-center justify-center text-white font-bold overflow-hidden">
                                                    <img id="question-photo-${q.student.id}" 
                                                         src="" 
                                                         alt="${q.student.name}" 
                                                         class="w-full h-full object-cover rounded-full hidden"
                                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                    <span id="question-initial-${q.student.id}" class="w-full h-full flex items-center justify-center">
                                                        ${q.student.name ? q.student.name.charAt(0) : '?'}
                                                    </span>
                                                </div>
                                                <div>
                                                    <p class="font-medium">${q.student.name || 'ูุงูุดุฎุต'}</p>
                                                    <p class="text-xs text-gray-500">${q.student.phoneNumber || 'ุจุฏูู ุดูุงุฑู'}</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="py-4 px-6">
                                            <div class="max-w-xs">
                                                <p class="text-gray-800 line-clamp-3">${q.question}</p>
                                            </div>
                                        </td>
                                        <td class="py-4 px-6">
                                            <span class="px-2 py-1 rounded-full text-xs font-medium ${getQuestionStatusColor(q.status)}">
                                                ${getQuestionStatusText(q.status)}
                                            </span>
                                        </td>
                                        <td class="py-4 px-6 text-sm text-gray-600">
                                            ${new Date(q.createdAt).toLocaleDateString('fa-IR')}
                                        </td>
                                        <td class="py-4 px-6">
                                            <div class="flex gap-2">
                                                <button onclick="viewQuestionDetails(${q.id})" class="p-2 border border-pink-300 text-pink-600 hover:bg-pink-50 rounded-xl transition-colors">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                                    </svg>
                                                </button>
                                                ${q.status === 'pending' ? `
                                                    <button onclick="answerQuestion(${q.id})" class="p-2 border border-green-300 text-green-600 hover:bg-green-50 rounded-xl transition-colors">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                                        </svg>
                                                    </button>
                                                ` : ''}
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Load photos for question students
            questions.forEach(q => {
                loadStudentPhoto(q.student.id, `question-photo-${q.student.id}`, `question-initial-${q.student.id}`);
            });
        }

        // Get question status color
        function getQuestionStatusColor(status) {
            switch (status) {
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'answered': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Get question status text
        function getQuestionStatusText(status) {
            switch (status) {
                case 'pending': return 'ุฏุฑ ุงูุชุธุงุฑ ูพุงุณุฎ';
                case 'answered': return 'ูพุงุณุฎ ุฏุงุฏู ุดุฏู';
                default: return status;
            }
        }

        // Get class type color
        function getClassTypeColor(type) {
            switch (type) {
                case 'private': return 'bg-blue-100 text-blue-800';
                case 'group': return 'bg-purple-100 text-purple-800';
                case 'test': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Get class type text
        function getClassTypeText(type) {
            switch (type) {
                case 'private': return 'ุฎุตูุต';
                case 'group': return 'ฺฏุฑูู';
                case 'test': return 'ุขุฒูุงุด';
                default: return type || 'ูุงูุดุฎุต';
            }
        }

        async function loadHomework() {
            try {
                const response = await fetch('/api/homework');
                const homework = await response.json();
                
                dashboardData.homework = homework;
                updateHomeworkTable(homework);
            } catch (error) {
                console.error('Error loading homework:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุชฺฉุงูู', 'error');
            }
        }

        // Update homework table
        function updateHomeworkTable(homework) {
            const container = document.getElementById('homework-assignments-content');
            if (!container) return;

            if (homework.length === 0) {
                container.innerHTML = '<p class="text-center py-8 text-gray-500">ุชฺฉูู ุงุฑุณุงู ูุดุฏู ุงุณุช</p>';
                return;
            }

            container.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-pink-50">
                                <tr>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ุฏุงูุดโุขููุฒ</th>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ุชฺฉูู</th>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ูุถุนุช</th>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ุชุงุฑุฎ ุงุฑุณุงู</th>
                                    <th class="px-6 py-4 text-right text-pink-600 font-semibold">ุนููุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="homework-table-body">
                                ${homework.map(hw => `
                                    <tr class="border-b border-pink-200 hover:bg-pink-50 transition-colors">
                                        <td class="py-4 px-6">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-gradient-to-br from-pink-300 to-purple-300 rounded-full flex items-center justify-center text-white font-bold overflow-hidden">
                                                    <img id="homework-photo-${hw.student.id}" 
                                                         src="" 
                                                         alt="${hw.student.name}" 
                                                         class="w-full h-full object-cover rounded-full hidden"
                                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                    <span id="homework-initial-${hw.student.id}" class="w-full h-full flex items-center justify-center">
                                                        ${hw.student.name ? hw.student.name.charAt(0) : '?'}
                                                    </span>
                                                </div>
                                                <div>
                                                    <p class="font-medium">${hw.student.name || 'ูุงูุดุฎุต'}</p>
                                                    <p class="text-xs text-gray-500">${hw.student.phoneNumber || 'ุจุฏูู ุดูุงุฑู'}</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="py-4 px-6">
                                            <div class="max-w-xs">
                                                <p class="font-medium text-gray-800 truncate">${hw.title || 'ุจุฏูู ุนููุงู'}</p>
                                                <p class="text-sm text-gray-600 mt-1 line-clamp-2">${hw.description || 'ุจุฏูู ุชูุถุญุงุช'}</p>
                                            </div>
                                        </td>
                                        <td class="py-4 px-6">
                                            <span class="px-2 py-1 rounded-full text-xs font-medium ${getHomeworkStatusColor(hw.status)}">
                                                ${getHomeworkStatusText(hw.status)}
                                            </span>
                                        </td>
                                        <td class="py-4 px-6 text-sm text-gray-600">
                                            ${new Date(hw.submittedAt).toLocaleDateString('fa-IR')}
                                        </td>
                                        <td class="py-4 px-6">
                                            <div class="flex gap-2">
                                                <button onclick="viewHomeworkDetails(${hw.id})" class="p-2 border border-pink-300 text-pink-600 hover:bg-pink-50 rounded-xl transition-colors">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                                    </svg>
                                                </button>
                                                <button onclick="updateHomeworkStatus(${hw.id})" class="p-2 border border-green-300 text-green-600 hover:bg-green-50 rounded-xl transition-colors">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            // Load photos for homework students
            homework.forEach(hw => {
                loadStudentPhoto(hw.student.id, `homework-photo-${hw.student.id}`, `homework-initial-${hw.student.id}`);
            });
        }

        // Get homework status color
        function getHomeworkStatusColor(status) {
            switch (status) {
                case 'submitted': return 'bg-yellow-100 text-yellow-800';
                case 'reviewed': return 'bg-blue-100 text-blue-800';
                case 'approved': return 'bg-green-100 text-green-800';
                case 'needs_revision': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Get homework status text
        function getHomeworkStatusText(status) {
            switch (status) {
                case 'submitted': return 'ุงุฑุณุงู ุดุฏู';
                case 'reviewed': return 'ุจุฑุฑุณ ุดุฏู';
                case 'approved': return 'ุชุฃุฏ ุดุฏู';
                case 'needs_revision': return 'ูุงุฒ ุจู ุจุงุฒูฺฏุฑ';
                default: return status;
            }
        }

        async function loadTestClasses() {
            try {
                const container = document.getElementById('test-classes-management-content');
                container.innerHTML = '<p class="text-center py-8 text-gray-500">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</p>';
                
                if (dashboardData.students) {
                    const testStudents = dashboardData.students.filter(s => s.classType === 'test' || s.registrationStatus === 'pending');
                    const pendingTestClasses = testStudents.filter(s => s.registrationStatus === 'pending');
                    const approvedTestClasses = testStudents.filter(s => s.registrationStatus === 'approved');
                    
                    container.innerHTML = `
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-green-50 border border-pink-200 rounded-xl shadow-lg p-6">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-400 rounded-2xl flex items-center justify-center">
                                            <span class="text-xl">๐</span>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600">ฺฉูุงุณโูุง ุขุฒูุงุด</p>
                                            <p class="text-green-600 text-xl font-bold">${testStudents.length}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 border border-pink-200 rounded-xl shadow-lg p-6">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-indigo-400 rounded-2xl flex items-center justify-center">
                                            <span class="text-xl">โ</span>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600">ุชุฃุฏ ุดุฏู</p>
                                            <p class="text-blue-600 text-xl font-bold">${approvedTestClasses.length}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-orange-50 border border-pink-200 rounded-xl shadow-lg p-6">
                                    <div class="flex items-center gap-3">
                                        <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-yellow-400 rounded-2xl flex items-center justify-center">
                                            <span class="text-xl">โณ</span>
                    </div>
                                        <div>
                                            <p class="text-sm text-gray-600">ุฏุฑ ุงูุชุธุงุฑ</p>
                                            <p class="text-orange-600 text-xl font-bold">${pendingTestClasses.length}</p>
                        </div>
                        </div>
                            </div>
                        </div>
                            
                            <div class="bg-white/80 backdrop-blur-sm border border-pink-200 rounded-xl shadow-lg">
                                <div class="p-6 border-b border-pink-200">
                                    <h3 class="text-pink-600 text-lg font-semibold">ุฏุฑุฎูุงุณุชโูุง ฺฉูุงุณ ุขุฒูุงุด</h3>
                                    <p class="text-gray-600 text-sm">ูุฏุฑุช ฺฉูุงุณโูุง ุขุฒูุงุด ุฑุงฺฏุงู</p>
                            </div>
                                <div class="p-6">
                                    ${testStudents.length === 0 ? 
                                        '<p class="text-center py-8 text-gray-500">ุฏุฑุฎูุงุณุช ฺฉูุงุณ ุขุฒูุงุด ูุฌูุฏ ูุฏุงุฑุฏ</p>' :
                                        testStudents.map(student => `
                                            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl hover:shadow-md transition-all mb-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 bg-gradient-to-br from-green-300 to-blue-300 rounded-full flex items-center justify-center text-white font-bold">
                                                        ${student.name ? student.name.charAt(0) : '?'}
                        </div>
                                                    <div>
                                                        <p class="text-gray-800 font-medium">${student.name || 'ูุงูุดุฎุต'}</p>
                                                        <p class="text-sm text-gray-500">${student.phoneNumber || 'ุชููู ูุงูุดุฎุต'}</p>
                                                        <p class="text-xs text-gray-400">${student.email || 'ุงูู ูุงูุดุฎุต'}</p>
                                                        <p class="text-xs text-gray-400">${student.selectedTime || 'ุฒูุงู ูุงูุดุฎุต'}</p>
                        </div>
                    </div>
                                                <div class="flex items-center gap-2">
                                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(student.registrationStatus)}">
                                                        ${getStatusText(student.registrationStatus)}
                                                    </span>
                                                    ${student.registrationStatus === 'pending' ? `
                                                        <button onclick="approveTestClass(${student.id})" class="p-2 bg-green-500 text-white hover:bg-green-600 rounded-xl transition-colors" title="ุชุฃุฏ">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                        </svg>
                                                    </button>
                                                        <button onclick="rejectTestClass(${student.id})" class="p-2 bg-red-500 text-white hover:bg-red-600 rounded-xl transition-colors" title="ุฑุฏ">
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                        </svg>
                                                    </button>
                                                    ` : `
                                                        <button onclick="viewTestClassDetails(${student.id})" class="p-2 bg-blue-500 text-white hover:bg-blue-600 rounded-xl transition-colors" title="ุฌุฒุฆุงุช">
                                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                                            </svg>
                                                        </button>
                                                    `}
                                                </div>
                                            </div>
                                        `).join('')
                                    }
                                </div>
                    </div>
                </div>
            `;
                } else {
                    container.innerHTML = '<p class="text-center py-8 text-gray-500">ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง</p>';
                    showNotification('โ ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง', 'error');
                }
            } catch (error) {
                console.error('Error loading test classes:', error);
                document.getElementById('test-classes-management-content').innerHTML = '<p class="text-center py-8 text-red-500">ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ฺฉูุงุณโูุง ุขุฒูุงุด</p>';
                showNotification('โ ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ฺฉูุงุณโูุง ุขุฒูุงุด', 'error');
            }
        }

        async function loadCalendar() {
            try {
                const container = document.getElementById('calendar-management-content');
                container.innerHTML = '<p class="text-center py-8 text-gray-500">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</p>';
                
                // Check calendar authentication status
                const statusResponse = await fetch('/api/calendar/status');
                const status = await statusResponse.json();
                
                // Display appointment scheduling information
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <span class="text-4xl">๐</span>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">ุณุณุชู ุฑุฒุฑู ฺฉูุงุณ ุขุฒูุงุด</h3>
                        <p class="text-gray-600 mb-6">ุจุฑุง ุฑุฒุฑู ฺฉูุงุณ ุขุฒูุงุดุ ุงุฒ ููฺฉ ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:</p>
                        <div class="bg-white border border-gray-200 rounded-xl p-6 mb-6">
                            <a href="${status.appointmentUrl}" target="_blank" class="text-blue-600 hover:text-blue-800 underline break-all">
                                ${status.appointmentUrl}
                            </a>
                        </div>
                        <p class="text-sm text-gray-500">ุฏุงูุดุฌูุงู ูโุชูุงููุฏ ุงุฒ ุงู ููฺฉ ุจุฑุง ุฑุฒุฑู ุฒูุงู ฺฉูุงุณ ุขุฒูุงุด ุงุณุชูุงุฏู ฺฉููุฏ.</p>
                    </div>
                `;
                return;
            } catch (error) {
                console.error('Error loading calendar status:', error);
                container.innerHTML = '<p class="text-center py-8 text-red-500">ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ูุถุนุช ุชููู</p>';
                return;
            }

            try {
                // Load calendar events
                const eventsResponse = await fetch('/api/calendar/events?days=30');
                const eventsData = await eventsResponse.json();
                const events = eventsData.events || [];
                
                // Get available time slots
                let availableSlots = [];
                try {
                    const slotsResponse = await fetch('/api/calendar/available-slots');
                    const slotsData = await slotsResponse.json();
                    availableSlots = slotsData.slots || [];
                } catch (error) {
                    console.error('Error fetching available slots:', error);
                }
                
                // Get upcoming classes from bot data
                const upcomingClasses = dashboardData.upcomingClasses || [];
                
                container.innerHTML = `
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-blue-50 border border-blue-200 rounded-xl shadow-lg p-6">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-indigo-400 rounded-2xl flex items-center justify-center">
                                        <span class="text-xl">๐</span>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">ุฑูุฏุงุฏูุง ุชููู</p>
                                        <p class="text-blue-600 text-xl font-bold">${events.length}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 border border-green-200 rounded-xl shadow-lg p-6">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-400 rounded-2xl flex items-center justify-center">
                                        <span class="text-xl">๐</span>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">ฺฉูุงุณโูุง ุขูุฏู</p>
                                        <p class="text-green-600 text-xl font-bold">${upcomingClasses.length}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 border border-purple-200 rounded-xl shadow-lg p-6">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-400 rounded-2xl flex items-center justify-center">
                                        <span class="text-xl">๐</span>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">ฺฉูุงุณโูุง ุขุฒูุงุด</p>
                                        <p class="text-purple-600 text-xl font-bold">${events.filter(e => e.summary && e.summary.includes('ุขุฒูุงุด')).length}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-orange-50 border border-orange-200 rounded-xl shadow-lg p-6">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-yellow-400 rounded-2xl flex items-center justify-center">
                                        <span class="text-xl">โฐ</span>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">ุงูุฑูุฒ</p>
                                        <p class="text-orange-600 text-xl font-bold">${events.filter(e => {
                                            const eventDate = new Date(e.start.dateTime || e.start.date);
                                            const today = new Date();
                                            return eventDate.toDateString() === today.toDateString();
                                        }).length}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="bg-white/80 backdrop-blur-sm border border-pink-200 rounded-xl shadow-lg">
                                <div class="p-6 border-b border-pink-200">
                                    <h3 class="text-blue-600 text-lg font-semibold">ุฑูุฏุงุฏูุง ุชููู Google</h3>
                                    <p class="text-gray-600 text-sm">ุขุฎุฑู ุฑูุฏุงุฏูุง ุชููู ุดูุง</p>
                                </div>
                                <div class="p-6 max-h-96 overflow-y-auto">
                                    ${events.length === 0 ? 
                                        '<p class="text-center py-8 text-gray-500">ุฑูุฏุงุฏ ุฏุฑ ุชููู ูุฌูุฏ ูุฏุงุฑุฏ</p>' :
                                        events.slice(0, 10).map(event => {
                                            const eventDate = new Date(event.start.dateTime || event.start.date);
                                            const isToday = eventDate.toDateString() === new Date().toDateString();
                                            return `
                                                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl hover:shadow-md transition-all mb-3">
                                                    <div class="flex items-center gap-3">
                                                        <div class="w-8 h-8 bg-gradient-to-br from-blue-300 to-purple-300 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                                            ${eventDate.getDate()}
                                                        </div>
                                                        <div>
                                                            <p class="text-gray-800 font-medium text-sm">${event.summary || 'ุจุฏูู ุนููุงู'}</p>
                                                            <p class="text-xs text-gray-500">${eventDate.toLocaleDateString('fa-IR')} ${eventDate.toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</p>
                                                        </div>
                                                    </div>
                                                    ${isToday ? '<span class="px-2 py-1 bg-orange-200 text-orange-700 rounded-full text-xs">ุงูุฑูุฒ</span>' : ''}
                                                </div>
                                            `;
                                        }).join('')
                                    }
                                </div>
                            </div>
                            
                            <div class="bg-white/80 backdrop-blur-sm border border-pink-200 rounded-xl shadow-lg">
                                <div class="p-6 border-b border-pink-200">
                                    <h3 class="text-green-600 text-lg font-semibold">ุฒูุงูโูุง ุฎุงู ุจุฑุง ฺฉูุงุณ ุขุฒูุงุด</h3>
                                    <p class="text-gray-600 text-sm">ุฒูุงูโูุง ููุฌูุฏ ุจุฑุง ุฑุฒุฑู ฺฉูุงุณ ุขุฒูุงุด</p>
                                </div>
                                <div class="p-6 max-h-96 overflow-y-auto">
                                    ${availableSlots.length === 0 ? 
                                        '<p class="text-center py-8 text-gray-500">ุฒูุงู ุฎุงู ุจุฑุง ฺฉูุงุณ ุขุฒูุงุด ูุฌูุฏ ูุฏุงุฑุฏ</p>' :
                                        availableSlots.slice(0, 10).map(slot => {
                                            const slotDate = new Date(slot.start);
                                            const isToday = slotDate.toDateString() === new Date().toDateString();
                                            return `
                                                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl hover:shadow-md transition-all mb-3">
                                                    <div class="flex items-center gap-3">
                                                        <div class="w-8 h-8 bg-gradient-to-br from-green-300 to-blue-300 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                                            ${slotDate.getDate()}
                                                        </div>
                                                        <div>
                                                            <p class="text-gray-800 font-medium text-sm">${slot.display}</p>
                                                            <p class="text-xs text-gray-500">ุฒูุงู ุฎุงู</p>
                                                        </div>
                                                    </div>
                                                    ${isToday ? '<span class="px-2 py-1 bg-green-200 text-green-700 rounded-full text-xs">ุงูุฑูุฒ</span>' : ''}
                                                </div>
                                            `;
                                        }).join('')
                                    }
                                </div>
                            </div>
                            
                            <div class="bg-white/80 backdrop-blur-sm border border-pink-200 rounded-xl shadow-lg">
                                <div class="p-6 border-b border-pink-200">
                                    <h3 class="text-green-600 text-lg font-semibold">ฺฉูุงุณโูุง ุจุฑูุงููโุฑุฒ ุดุฏู</h3>
                                    <p class="text-gray-600 text-sm">ฺฉูุงุณโูุง ุซุจุช ุดุฏู ุฏุฑ ุณุณุชู</p>
                                </div>
                                <div class="p-6 max-h-96 overflow-y-auto">
                                    ${upcomingClasses.length === 0 ? 
                                        '<p class="text-center py-8 text-gray-500">ฺฉูุงุณ ุจุฑุง ููุงุด ูุฌูุฏ ูุฏุงุฑุฏ</p>' :
                                        upcomingClasses.slice(0, 10).map(classItem => {
                                            const classDate = new Date(classItem.date);
                                            return `
                                                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl hover:shadow-md transition-all mb-3">
                                                    <div class="flex items-center gap-3">
                                                        <div class="w-8 h-8 bg-gradient-to-br from-green-300 to-blue-300 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                                            ${classDate.getDate()}
                                                        </div>
                                                        <div>
                                                            <p class="text-gray-800 font-medium text-sm">${classItem.student.name}</p>
                                                            <p class="text-xs text-gray-500">${classDate.toLocaleDateString('fa-IR')} - ${classItem.time}</p>
                                                        </div>
                                                    </div>
                                                    <span class="px-2 py-1 bg-green-200 text-green-700 rounded-full text-xs">${classItem.status === 'scheduled' ? 'ุจุฑูุงููโุฑุฒ ุดุฏู' : classItem.status}</span>
                                                </div>
                                            `;
                                        }).join('')
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading calendar:', error);
                document.getElementById('calendar-management-content').innerHTML = '<p class="text-center py-8 text-red-500">ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุชููู</p>';
            }
        }
        

        async function loadPayments() {
            try {
                const container = document.getElementById('payments-finance-content');
                container.innerHTML = '<p class="text-center py-8 text-gray-500">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</p>';
                
                // Get students with payment information
                const students = dashboardData.students || [];
                const approvedStudents = students.filter(student => student.registrationStatus === 'approved');
                
                // Calculate payment statistics
                const totalStudents = approvedStudents.length;
                const paidStudents = approvedStudents.filter(s => s.paymentStatus === 'paid').length;
                const unpaidStudents = approvedStudents.filter(s => s.paymentStatus === 'unpaid').length;
                const overdueStudents = approvedStudents.filter(s => s.paymentStatus === 'overdue').length;
                
                // Calculate total revenue (mock data for now)
                const totalRevenue = paidStudents * 500000; // 500,000 Toman per student
                const pendingRevenue = unpaidStudents * 500000;
                
                container.innerHTML = `
                    <div class="space-y-6">
                        <!-- Payment Statistics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div class="bg-gradient-to-r from-green-400 to-green-500 rounded-xl p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-green-100 text-sm">ูพุฑุฏุงุฎุช ุดุฏู</p>
                                        <p class="text-2xl font-bold">${paidStudents}</p>
                                    </div>
                                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                        <span class="text-2xl">โ</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 rounded-xl p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-yellow-100 text-sm">ูพุฑุฏุงุฎุช ูุดุฏู</p>
                                        <p class="text-2xl font-bold">${unpaidStudents}</p>
                                    </div>
                                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                        <span class="text-2xl">โณ</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-red-400 to-red-500 rounded-xl p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-red-100 text-sm">ูุนูู</p>
                                        <p class="text-2xl font-bold">${overdueStudents}</p>
                                    </div>
                                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                        <span class="text-2xl">โ๏ธ</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-blue-400 to-blue-500 rounded-xl p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-blue-100 text-sm">ุฏุฑุขูุฏ ฺฉู</p>
                                        <p class="text-2xl font-bold">${totalRevenue.toLocaleString('fa-IR')}</p>
                                        <p class="text-blue-100 text-xs">ุชููุงู</p>
                                    </div>
                                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                        <span class="text-2xl">๐ฐ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Actions -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">ุนููุงุช ูพุฑุฏุงุฎุช</h3>
                                <div class="flex gap-2">
                                    <button onclick="showBulkPaymentReminderModal()" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors">
                                        ุงุฑุณุงู ุงุฏุขูุฑ ฺฏุฑูู
                                    </button>
                                    <button onclick="exportPaymentReport()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                        ฺฏุฒุงุฑุด ูุงู
                                    </button>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-yellow-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-yellow-800 mb-2">ุฏุฑ ุงูุชุธุงุฑ ูพุฑุฏุงุฎุช</h4>
                                    <p class="text-2xl font-bold text-yellow-600">${pendingRevenue.toLocaleString('fa-IR')}</p>
                                    <p class="text-sm text-yellow-600">ุชููุงู</p>
                                </div>
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-green-800 mb-2">ุฏุฑุงูุช ุดุฏู</h4>
                                    <p class="text-2xl font-bold text-green-600">${totalRevenue.toLocaleString('fa-IR')}</p>
                                    <p class="text-sm text-green-600">ุชููุงู</p>
                                </div>
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-blue-800 mb-2">ฺฉู ุฏุงูุดโุขููุฒุงู</h4>
                                    <p class="text-2xl font-bold text-blue-600">${totalStudents}</p>
                                    <p class="text-sm text-blue-600">ููุฑ</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Students Payment List -->
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ูุณุช ูพุฑุฏุงุฎุชโูุง</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ูุงู ุฏุงูุดุฌู</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุชููู</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุฌูุณุงุช ุจุงูโูุงูุฏู</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ูุถุนุช ูพุฑุฏุงุฎุช</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ูุจูุบ</th>
                                            <th class="text-right py-3 px-4 font-medium text-gray-700">ุนููุงุช</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${approvedStudents.length === 0 ? 
                                            '<tr><td colspan="6" class="text-center py-8 text-gray-500">ูฺ ุฏุงูุดโุขููุฒ ุชุฃุฏ ุดุฏูโุง ูุฌูุฏ ูุฏุงุฑุฏ</td></tr>' :
                                            approvedStudents.map(student => `
                                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                                    <td class="py-4 px-4">
                                                        <div class="flex items-center gap-3">
                                                            <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                                                ${student.name.charAt(0)}
                                                            </div>
                                                            <span class="font-medium text-gray-800">${student.name}</span>
                                                        </div>
                                                    </td>
                                                    <td class="py-4 px-4 text-gray-600">${student.phoneNumber || 'ูุงูุดุฎุต'}</td>
                                                    <td class="py-4 px-4">
                                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                                                            ${student.sessionsLeft || 0} ุฌูุณู
                                                        </span>
                                                    </td>
                                                    <td class="py-4 px-4">
                                                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getPaymentColor(student.paymentStatus)}">
                                                            ${getPaymentText(student.paymentStatus)}
                                                        </span>
                                                    </td>
                                                    <td class="py-4 px-4">
                                                        <span class="font-medium text-gray-800">500,000</span>
                                                        <span class="text-sm text-gray-500">ุชููุงู</span>
                                                    </td>
                                                    <td class="py-4 px-4">
                                                        <div class="flex items-center gap-2">
                                                            ${student.paymentStatus === 'unpaid' || student.paymentStatus === 'overdue' ? 
                                                                `<button onclick="showPaymentReminderModal(${student.id}, '${student.name}')" class="p-2 text-yellow-500 hover:bg-yellow-50 rounded-lg transition-colors" title="ุงุฑุณุงู ุงุฏุขูุฑ ูพุฑุฏุงุฎุช">
                                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5v-5a7.5 7.5 0 1 0-15 0v5h5l-5 5-5-5h5v-5a7.5 7.5 0 1 0 15 0v5z"></path>
                                                                    </svg>
                                                                </button>` : ''
                                                            }
                                                            <button onclick="markAsPaid(${student.id})" class="p-2 text-green-500 hover:bg-green-50 rounded-lg transition-colors" title="ุนูุงูุชโฺฏุฐุงุฑ ุจู ุนููุงู ูพุฑุฏุงุฎุช ุดุฏู">
                                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                                </svg>
                                                            </button>
                                                            <button onclick="viewPaymentDetails(${student.id})" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors" title="ุฌุฒุฆุงุช ูพุฑุฏุงุฎุช">
                                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                                                </svg>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `).join('')
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading payments:', error);
                document.getElementById('payments-finance-content').innerHTML = '<p class="text-center py-8 text-red-500">ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ุงุทูุงุนุงุช ูพุฑุฏุงุฎุช</p>';
            }
        }

        async function loadAnalytics() {
            document.getElementById('analytics-reports-content').innerHTML = '<p class="text-center py-8 text-gray-500">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</p>';
            // Implementation for analytics
        }

        async function loadNotifications() {
            document.getElementById('notifications-communications-content').innerHTML = '<p class="text-center py-8 text-gray-500">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</p>';
            // Implementation for notifications
        }

        async function loadSettings() {
            document.getElementById('settings-configuration-content').innerHTML = '<p class="text-center py-8 text-gray-500">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</p>';
            // Implementation for settings
        }

        async function approveTestClass(studentId) {
            if (confirm('ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ฺฉูุงุณ ุขุฒูุงุด ุฑุง ุชุฃุฏ ฺฉูุฏุ')) {
                try {
                    const response = await fetch(`/api/students/${studentId}/approve`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                        alert('ฺฉูุงุณ ุขุฒูุงุด ุจุง ููููุช ุชุฃุฏ ุดุฏ');
                        loadTestClasses();
                } else {
                        alert('ุฎุทุง ุฏุฑ ุชุฃุฏ ฺฉูุงุณ ุขุฒูุงุด');
                }
            } catch (error) {
                    console.error('Error approving test class:', error);
                    alert('ุฎุทุง ุฏุฑ ุชุฃุฏ ฺฉูุงุณ ุขุฒูุงุด');
                }
            }
        }

        async function rejectTestClass(studentId) {
            if (confirm('ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ฺฉูุงุณ ุขุฒูุงุด ุฑุง ุฑุฏ ฺฉูุฏุ')) {
                try {
                    const response = await fetch(`/api/students/${studentId}/reject`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                        alert('ฺฉูุงุณ ุขุฒูุงุด ุฑุฏ ุดุฏ');
                        loadTestClasses();
                } else {
                        alert('ุฎุทุง ุฏุฑ ุฑุฏ ฺฉูุงุณ ุขุฒูุงุด');
                }
            } catch (error) {
                    console.error('Error rejecting test class:', error);
                    alert('ุฎุทุง ุฏุฑ ุฑุฏ ฺฉูุงุณ ุขุฒูุงุด');
                }
            }
        }

        async function authenticateGoogleCalendar() {
            try {
                const response = await fetch('/api/calendar/auth-url');
                const data = await response.json();
                
                if (data.authUrl) {
                    // Open authentication URL in new window
                    const authWindow = window.open(data.authUrl, 'google-auth', 'width=500,height=600,scrollbars=yes,resizable=yes');
                    
                    // Listen for authentication completion
                    const checkAuth = setInterval(async () => {
                        try {
                            const statusResponse = await fetch('/api/calendar/status');
                            const status = await statusResponse.json();
                            
                            if (status.authenticated) {
                                clearInterval(checkAuth);
                                authWindow.close();
                                alert('โ ุงุชุตุงู ุจู Google Calendar ุจุง ููููุช ุงูุฌุงู ุดุฏ!');
                                loadCalendar();
                            }
            } catch (error) {
                            console.error('Error checking auth status:', error);
                        }
                    }, 2000);
                    
                    // Clear interval after 5 minutes
                    setTimeout(() => {
                        clearInterval(checkAuth);
                        if (!authWindow.closed) {
                            authWindow.close();
                        }
                    }, 300000);
                } else {
                    alert('โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ููฺฉ ุงุญุฑุงุฒ ููุช');
                }
            } catch (error) {
                console.error('Error authenticating:', error);
                alert('โ ุฎุทุง ุฏุฑ ุงุชุตุงู ุจู Google Calendar');
            }
        }

        async function refreshCalendar() {
            await loadCalendar();
        }

        function showError(message) {
            alert(message);
        }

        // Notification system
        function showNotification(message, type = 'info', duration = 5000) {
            const notificationArea = document.getElementById('notification-area');
            
            const notification = document.createElement('div');
            notification.className = `notification p-4 rounded-lg shadow-lg mb-4 transform transition-all duration-300 ease-in-out ${
                type === 'success' ? 'bg-green-100 border border-green-300 text-green-800' :
                type === 'error' ? 'bg-red-100 border border-red-300 text-red-800' :
                type === 'warning' ? 'bg-yellow-100 border border-yellow-300 text-yellow-800' :
                'bg-blue-100 border border-blue-300 text-blue-800'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full flex items-center justify-center ${
                            type === 'success' ? 'bg-green-500' :
                            type === 'error' ? 'bg-red-500' :
                            type === 'warning' ? 'bg-yellow-500' :
                            'bg-blue-500'
                        }">
                            <span class="text-white text-sm">
                                ${type === 'success' ? 'โ' : type === 'error' ? 'โ' : type === 'warning' ? 'โ' : 'โน'}
                            </span>
                        </div>
                        <span class="font-medium">${message}</span>
                    </div>
                    <button onclick="removeNotification(this)" class="text-gray-500 hover:text-gray-700 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            // Add slide-in animation
            notification.style.transform = 'translateX(100%)';
            notification.style.opacity = '0';
            
            notificationArea.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 10);
            
            // Auto remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    removeNotification(notification.querySelector('button'));
                }, duration);
            }
        }

        function removeNotification(button) {
            const notification = button.closest('.notification');
            if (notification) {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }
        }

        function clearAllNotifications() {
            const notificationArea = document.getElementById('notification-area');
            notificationArea.innerHTML = '';
        }

        // Custom Confirmation Modal System
        let currentConfirmationCallback = null;
        let currentConfirmationData = null;

        function showConfirmationModal(config) {
            const modal = document.getElementById('confirmation-modal');
            const modalContent = document.getElementById('modal-content');
            const modalIcon = document.getElementById('modal-icon');
            const modalIconText = document.getElementById('modal-icon-text');
            const modalTitle = document.getElementById('modal-title');
            const modalSubtitle = document.getElementById('modal-subtitle');
            const modalMessage = document.getElementById('modal-message');
            const modalDetails = document.getElementById('modal-details');
            const modalConfirm = document.getElementById('modal-confirm');

            // Set modal content
            modalTitle.textContent = config.title || 'ุชุฃุฏ ุนููุงุช';
            modalSubtitle.textContent = config.subtitle || 'ูุทูุงู ุชุฃุฏ ฺฉูุฏ';
            modalMessage.textContent = config.message || 'ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ุนููุงุช ุฑุง ุงูุฌุงู ุฏูุฏุ';
            
            // Set icon and colors based on type
            const type = config.type || 'warning';
            const colors = {
                success: { bg: 'bg-green-100', icon: 'bg-green-500', button: 'bg-green-500 hover:bg-green-600' },
                error: { bg: 'bg-red-100', icon: 'bg-red-500', button: 'bg-red-500 hover:bg-red-600' },
                warning: { bg: 'bg-yellow-100', icon: 'bg-yellow-500', button: 'bg-yellow-500 hover:bg-yellow-600' },
                info: { bg: 'bg-blue-100', icon: 'bg-blue-500', button: 'bg-blue-500 hover:bg-blue-600' }
            };
            
            const colorScheme = colors[type] || colors.warning;
            
            modalIcon.className = `w-12 h-12 rounded-full flex items-center justify-center ${colorScheme.bg}`;
            modalIconText.textContent = config.icon || (type === 'success' ? 'โ' : type === 'error' ? 'โ' : type === 'warning' ? 'โ๏ธ' : 'โน๏ธ');
            modalConfirm.className = `px-6 py-2 rounded-xl transition-colors font-medium text-white ${colorScheme.button}`;
            modalConfirm.textContent = config.confirmText || 'ุชุฃุฏ';
            
            // Set details if provided
            if (config.details) {
                modalDetails.innerHTML = config.details;
                modalDetails.classList.remove('hidden');
            } else {
                modalDetails.classList.add('hidden');
            }
            
            // Store callback and data
            currentConfirmationCallback = config.onConfirm;
            currentConfirmationData = config.data;
            
            // Show modal with animation
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        function hideConfirmationModal() {
            const modal = document.getElementById('confirmation-modal');
            const modalContent = document.getElementById('modal-content');
            
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                currentConfirmationCallback = null;
                currentConfirmationData = null;
            }, 300);
        }

        function confirmAction() {
            if (currentConfirmationCallback) {
                currentConfirmationCallback(currentConfirmationData);
            }
            hideConfirmationModal();
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('confirmation-modal');
            const modalContent = document.getElementById('modal-content');
            
            if (event.target === modal) {
                hideConfirmationModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                hideConfirmationModal();
            }
        });

        // Demo function to test different modal types (for testing purposes)
        function testModal(type) {
            showConfirmationModal({
                type: type,
                title: `ุชุณุช ููุฏุงู ${type}`,
                subtitle: 'ููููู ุชุณุช',
                message: `ุงู ฺฉ ููุฏุงู ุชุณุช ุงุฒ ููุน ${type} ุงุณุช.`,
                details: `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-medium">ููุน:</span>
                            <span>${type}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุฒูุงู:</span>
                            <span>${new Date().toLocaleTimeString('fa-IR')}</span>
                        </div>
                    </div>
                `,
                confirmText: 'ุชุณุช',
                onConfirm: () => {
                    showNotification(`ููุฏุงู ${type} ุชุฃุฏ ุดุฏ!`, 'success');
                }
            });
        }

        // Test function for teacher approval modal
        function testTeacherApproval() {
            // Create a mock student for testing
            const mockStudent = {
                id: 999,
                name: 'ุณุงุฑุง ุงุญูุฏ (ุชุณุช)',
                phoneNumber: '09123456789',
                city: 'ุชูุฑุงู',
                selectedDays: 'ุฏูุดูุจู, ฺูุงุฑุดูุจู',
                selectedTimes: 'ุจุนุฏ ุงุฒ ุธูุฑ 3 ุชุง 6',
                sessionsPerWeek: '2',
                level: 'ูุจุชุฏ',
                learningReason: 'ุนูุงูู ุจู ุงุฏฺฏุฑ ุฒุจุงู ูุฑุงูุณู',
                experience: 'ูุฏุงุฑู',
                registrationStatus: 'pending'
            };

            // Temporarily add to dashboard data for testing
            if (!dashboardData.students) {
                dashboardData.students = [];
            }
            dashboardData.students.push(mockStudent);

            showTeacherApprovalModal(999);
        }

        // Payment Reminder Modal Functions
        let currentPaymentStudent = null;

        function showPaymentReminderModal(studentId, studentName) {
            currentPaymentStudent = { id: studentId, name: studentName };
            
            // Update modal content
            document.getElementById('payment-student-name').textContent = studentName;
            document.getElementById('payment-amount').value = '500000';
            document.getElementById('payment-message').value = '';
            
            // Show modal
            const modal = document.getElementById('payment-reminder-modal');
            const modalContent = document.getElementById('payment-reminder-modal-content');
            
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        function hidePaymentReminderModal() {
            const modal = document.getElementById('payment-reminder-modal');
            const modalContent = document.getElementById('payment-reminder-modal-content');
            
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                currentPaymentStudent = null;
            }, 300);
        }

        async function sendCustomPaymentReminder() {
            if (!currentPaymentStudent) return;
            
            const amount = document.getElementById('payment-amount').value;
            const customMessage = document.getElementById('payment-message').value;
            
            if (!amount || amount <= 0) {
                showNotification('โ ูุทูุงู ูุจูุบ ูพุฑุฏุงุฎุช ุฑุง ูุงุฑุฏ ฺฉูุฏ', 'error');
                return;
            }
            
            try {
                showNotification('ุฏุฑ ุญุงู ุงุฑุณุงู ุงุฏุขูุฑ ูพุฑุฏุงุฎุช...', 'info', 0);
                
                const response = await fetch(`/api/students/${currentPaymentStudent.id}/custom-payment-reminder`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        amount: parseInt(amount),
                        customMessage: customMessage
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showNotification('โ ุงุฏุขูุฑ ูพุฑุฏุงุฎุช ุงุฑุณุงู ุดุฏ', 'success');
                    console.log('Custom payment reminder sent:', result);
                    hidePaymentReminderModal();
                    // Refresh data after successful action
                    loadPayments();
                    loadStudents();
                } else {
                    const error = await response.json();
                    showNotification(`โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงุฏุขูุฑ ูพุฑุฏุงุฎุช: ${error.error}`, 'error');
                    console.error('Custom payment reminder error:', error);
                }
            } catch (error) {
                console.error('Error sending custom payment reminder:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงุฏุขูุฑ ูพุฑุฏุงุฎุช', 'error');
            }
        }

        // Test function for payment reminder
        function testPaymentReminder() {
            // Use the price input modal for testing too
            showPaymentReminderModal(4, 'ุณุงุฑุง ุนุฑุจ ุฒุงุฏู (ุชุณุช)');
        }

        // Bulk Payment Reminder Modal Functions
        function showBulkPaymentReminderModal() {
            // Show modal
            const modal = document.getElementById('bulk-payment-reminder-modal');
            const modalContent = document.getElementById('bulk-payment-reminder-modal-content');
            
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        function hideBulkPaymentReminderModal() {
            const modal = document.getElementById('bulk-payment-reminder-modal');
            const modalContent = document.getElementById('bulk-payment-reminder-modal-content');
            
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        async function sendBulkPaymentReminders() {
            const amount = document.getElementById('bulk-payment-amount').value;
            const customMessage = document.getElementById('bulk-payment-message').value;
            
            if (!amount || amount <= 0) {
                showNotification('โ ูุทูุงู ูุจูุบ ูพุฑุฏุงุฎุช ุฑุง ูุงุฑุฏ ฺฉูุฏ', 'error');
                return;
            }
            
            try {
                showNotification('ุฏุฑ ุญุงู ุงุฑุณุงู ุงุฏุขูุฑโูุง ฺฏุฑูู...', 'info', 0);
                
                const response = await fetch('/api/payments/send-bulk-reminders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        amount: parseInt(amount),
                        customMessage: customMessage
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showNotification(`โ ${result.successCount} ุงุฏุขูุฑ ูพุฑุฏุงุฎุช ุงุฑุณุงู ุดุฏ`, 'success');
                    console.log('Bulk payment reminders sent:', result);
                    hideBulkPaymentReminderModal();
                    loadPayments();
                } else {
                    const error = await response.json();
                    showNotification(`โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงุฏุขูุฑโูุง ฺฏุฑูู: ${error.error}`, 'error');
                    console.error('Bulk payment reminder error:', error);
                }
            } catch (error) {
                console.error('Error sending bulk payment reminders:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงุฏุขูุฑโูุง ฺฏุฑูู', 'error');
            }
        }

        // View Modal System
        function showViewModal(config) {
            const modal = document.getElementById('view-modal');
            const modalContent = document.getElementById('view-modal-content');
            const modalIcon = document.getElementById('view-modal-icon');
            const modalIconText = document.getElementById('view-modal-icon-text');
            const modalTitle = document.getElementById('view-modal-title');
            const modalSubtitle = document.getElementById('view-modal-subtitle');
            const modalBody = document.getElementById('view-modal-body');

            // Set modal content
            modalTitle.textContent = config.title || 'ุฌุฒุฆุงุช';
            modalSubtitle.textContent = config.subtitle || 'ุงุทูุงุนุงุช ฺฉุงูู';
            modalIconText.textContent = config.icon || '๐ค';
            modalBody.innerHTML = config.content || '';

            // Set icon color based on type
            const type = config.type || 'info';
            const colors = {
                student: 'bg-blue-100',
                test: 'bg-green-100',
                class: 'bg-purple-100',
                payment: 'bg-yellow-100'
            };
            
            modalIcon.className = `w-12 h-12 rounded-full flex items-center justify-center ${colors[type] || colors.student}`;

            // Show modal with animation
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        function hideViewModal() {
            const modal = document.getElementById('view-modal');
            const modalContent = document.getElementById('view-modal-content');
            
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // Close view modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('view-modal');
            const modalContent = document.getElementById('view-modal-content');
            
            if (event.target === modal) {
                hideViewModal();
            }
        });

        // Teacher Approval Modal System
        let currentApprovalStudent = null;
        let classScheduleCount = 0;

        function showTeacherApprovalModal(studentId) {
            const student = dashboardData.students?.find(s => s.id === studentId);
            if (!student) {
                showNotification('โ ุฏุงูุดโุขููุฒ ุงูุช ูุดุฏ', 'error');
                return;
            }

            currentApprovalStudent = student;
            classScheduleCount = 0;

            // Populate student info
            document.getElementById('teacher-approval-student-name').textContent = student.name;
            document.getElementById('teacher-approval-student-info').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h5 class="font-semibold text-gray-800 mb-2">ุงุทูุงุนุงุช ุดุฎุต</h5>
                        <p class="text-sm text-gray-600">ูุงู: ${student.name}</p>
                        <p class="text-sm text-gray-600">ุชููู: ${student.phoneNumber || 'ูุงูุดุฎุต'}</p>
                        <p class="text-sm text-gray-600">ุดูุฑ: ${student.city || 'ูุงูุดุฎุต'}</p>
                    </div>
                    <div>
                        <h5 class="font-semibold text-gray-800 mb-2">ุชุฑุฌุญุงุช ุฏุงูุดุฌู</h5>
                        <p class="text-sm text-gray-600">ุฑูุฒูุง ุชุฑุฌุญ: ${student.selectedDays || 'ูุงูุดุฎุต'}</p>
                        <p class="text-sm text-gray-600">ุณุงุนุงุช ุชุฑุฌุญ: ${student.selectedTimes || 'ูุงูุดุฎุต'}</p>
                        <p class="text-sm text-gray-600">ุฌูุณุงุช ุฏุฑ ููุชู: ${student.sessionsPerWeek || 'ูุงูุดุฎุต'}</p>
                    </div>
                </div>
            `;

            // Initialize class schedule configuration
            initializeClassSchedule();

            // Show modal
            const modal = document.getElementById('teacher-approval-modal');
            const modalContent = document.getElementById('teacher-approval-modal-content');
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        function hideTeacherApprovalModal() {
            const modal = document.getElementById('teacher-approval-modal');
            const modalContent = document.getElementById('teacher-approval-modal-content');
            
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
                currentApprovalStudent = null;
                classScheduleCount = 0;
            }, 300);
        }

        function initializeClassSchedule() {
            const container = document.getElementById('class-schedule-config');
            container.innerHTML = '';
            classScheduleCount = 0;
            addClassSchedule(); // Add first schedule entry
        }

        function addClassSchedule() {
            classScheduleCount++;
            const container = document.getElementById('class-schedule-config');
            
            const scheduleEntry = document.createElement('div');
            scheduleEntry.className = 'border border-gray-200 rounded-lg p-4 mb-4';
            scheduleEntry.id = `schedule-${classScheduleCount}`;
            
            scheduleEntry.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <h6 class="font-medium text-gray-700">ฺฉูุงุณ ${classScheduleCount}</h6>
                    ${classScheduleCount > 1 ? `<button onclick="removeClassSchedule(${classScheduleCount})" class="text-red-500 hover:text-red-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>` : ''}
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ุฑูุฒ ููุชู</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                            <option value="ุดูุจู">ุดูุจู</option>
                            <option value="ฺฉุดูุจู">ฺฉุดูุจู</option>
                            <option value="ุฏูุดูุจู">ุฏูุดูุจู</option>
                            <option value="ุณูโุดูุจู">ุณูโุดูุจู</option>
                            <option value="ฺูุงุฑุดูุจู">ฺูุงุฑุดูุจู</option>
                            <option value="ูพูุฌโุดูุจู">ูพูุฌโุดูุจู</option>
                            <option value="ุฌูุนู">ุฌูุนู</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ุณุงุนุช</label>
                        <input type="time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500" value="16:00">
                    </div>
                </div>
            `;
            
            container.appendChild(scheduleEntry);
        }

        function removeClassSchedule(scheduleId) {
            const element = document.getElementById(`schedule-${scheduleId}`);
            if (element) {
                element.remove();
            }
        }

        async function approveStudentWithSettings() {
            if (!currentApprovalStudent) {
                showNotification('โ ุฎุทุง ุฏุฑ ุชุฃุฏ ุฏุงูุดโุขููุฒ', 'error');
                return;
            }

            try {
                // Collect class schedule data
                const classTimes = [];
                const scheduleElements = document.querySelectorAll('[id^="schedule-"]');
                
                scheduleElements.forEach(element => {
                    const daySelect = element.querySelector('select');
                    const timeInput = element.querySelector('input[type="time"]');
                    
                    if (daySelect && timeInput) {
                        classTimes.push({
                            day: daySelect.value,
                            time: timeInput.value
                        });
                    }
                });

                if (classTimes.length === 0) {
                    showNotification('โ ูุทูุงู ุญุฏุงูู ฺฉ ุฑูุฒ ู ุณุงุนุช ุจุฑุง ฺฉูุงุณ ุชูุธู ฺฉูุฏ', 'error');
                    return;
                }

                // Collect other settings
                const totalSessions = parseInt(document.getElementById('total-sessions').value);
                const sessionsPerWeek = document.getElementById('sessions-per-week').value;
                const paymentStatus = document.getElementById('payment-status').value;

                showNotification('ุฏุฑ ุญุงู ุชุฃุฏ ุฏุงูุดโุขููุฒ...', 'info', 0);

                const response = await fetch(`/api/students/${currentApprovalStudent.id}/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionsLeft: totalSessions,
                        sessionsPerWeek: sessionsPerWeek,
                        selectedDays: classTimes.map(ct => ct.day),
                        classTimes: classTimes,
                        paymentStatus: paymentStatus
                    })
                });

                if (response.ok) {
                    showNotification('โ ุฏุงูุดโุขููุฒ ุจุง ููููุช ุชุฃุฏ ุดุฏ! ูพุงู ุชุฃุฏ ุงุฑุณุงู ุดุฏ.', 'success');
                    hideTeacherApprovalModal();
                    loadStudents();
                } else {
                    showNotification('โ ุฎุทุง ุฏุฑ ุชุฃุฏ ุฏุงูุดโุขููุฒ', 'error');
                }
            } catch (error) {
                console.error('Error approving student:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุชุฃุฏ ุฏุงูุดโุขููุฒ', 'error');
            }
        }

        // Close teacher approval modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('teacher-approval-modal');
            const modalContent = document.getElementById('teacher-approval-modal-content');
            
            if (event.target === modal) {
                hideTeacherApprovalModal();
            }
        });

        // Class Details View
        async function viewClassDetails(classId) {
            try {
                const response = await fetch(`/api/classes/${classId}`);
                if (!response.ok) {
                    showNotification('โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุฌุฒุฆุงุช ฺฉูุงุณ', 'error');
                    return;
                }
                
                const classData = await response.json();
                
                showViewModal({
                    title: 'ุฌุฒุฆุงุช ฺฉูุงุณ',
                    subtitle: `${classData.student?.name || 'ูุงูุดุฎุต'}`,
                    icon: '๐',
                    type: 'info',
                    content: `
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h5 class="font-semibold text-blue-800 mb-2">ุงุทูุงุนุงุช ฺฉูุงุณ</h5>
                                    <p class="text-sm text-blue-700">ุฑูุฒ: ${classData.day}</p>
                                    <p class="text-sm text-blue-700">ุณุงุนุช: ${classData.time}</p>
                                    <p class="text-sm text-blue-700">ุชุงุฑุฎ: ${new Date(classData.date).toLocaleDateString('fa-IR')}</p>
                                    <p class="text-sm text-blue-700">ูุถุนุช: ${classData.status === 'scheduled' ? 'ุจุฑูุงููโุฑุฒ ุดุฏู' : classData.status}</p>
                                </div>
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h5 class="font-semibold text-green-800 mb-2">ุงุทูุงุนุงุช ุฏุงูุดุฌู</h5>
                                    <p class="text-sm text-green-700">ูุงู: ${classData.student?.name || 'ูุงูุดุฎุต'}</p>
                                    <p class="text-sm text-green-700">ุชููู: ${classData.student?.phoneNumber || 'ูุงูุดุฎุต'}</p>
                                    <p class="text-sm text-green-700">ุดูุฑ: ${classData.student?.city || 'ูุงูุดุฎุต'}</p>
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 rounded-lg p-4">
                                <h5 class="font-semibold text-purple-800 mb-2">ููฺฉ ฺฉูุงุณ</h5>
                                <p class="text-sm text-purple-700 mb-2">ููฺฉ ฺฉูุงุณ ุขููุงู:</p>
                                <div class="flex items-center gap-2">
                                    <input type="text" value="https://meet.google.com/emb-fhpm-gwp" readonly class="flex-1 px-3 py-2 bg-white border border-purple-200 rounded-lg text-sm">
                                    <button onclick="copyClassLink()" class="px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm">
                                        ฺฉูพ
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex gap-2">
                                <button onclick="sendClassReminder(${classId})" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                    ุงุฑุณุงู ุงุฏุขูุฑ
                                </button>
                                <button onclick="cancelClass(${classId})" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                    ฺฉูุณู ฺฉุฑุฏู ฺฉูุงุณ
                                </button>
                            </div>
                        </div>
                    `
                });
            } catch (error) {
                console.error('Error viewing class details:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุฌุฒุฆุงุช ฺฉูุงุณ', 'error');
            }
        }

        function copyClassLink() {
            const input = document.querySelector('input[readonly]');
            input.select();
            document.execCommand('copy');
            showNotification('โ ููฺฉ ฺฉูุงุณ ฺฉูพ ุดุฏ', 'success');
        }

        async function sendClassReminder(classId) {
            try {
                const response = await fetch(`/api/classes/${classId}/remind`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showNotification('โ ุงุฏุขูุฑ ฺฉูุงุณ ุงุฑุณุงู ุดุฏ', 'success');
                    // Refresh classes data
                    loadClasses();
                } else {
                    showNotification('โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงุฏุขูุฑ', 'error');
                }
            } catch (error) {
                console.error('Error sending reminder:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงุฏุขูุฑ', 'error');
            }
        }

        async function cancelClass(classId) {
            showConfirmationModal({
                type: 'warning',
                title: 'ฺฉูุณู ฺฉุฑุฏู ฺฉูุงุณ',
                subtitle: 'ุขุง ูุทูุฆู ูุณุชุฏุ',
                message: 'ุงู ฺฉูุงุณ ฺฉูุณู ุฎูุงูุฏ ุดุฏ ู ุฏุงูุดุฌู ูุทูุน ุฎูุงูุฏ ุดุฏ.',
                confirmText: 'ฺฉูุณู ฺฉู',
                onConfirm: async () => {
                    try {
                        const response = await fetch(`/api/classes/${classId}/cancel`, {
                            method: 'POST'
                        });
                        
                        if (response.ok) {
                            showNotification('โ ฺฉูุงุณ ฺฉูุณู ุดุฏ', 'success');
                            loadClasses();
                        } else {
                            showNotification('โ ุฎุทุง ุฏุฑ ฺฉูุณู ฺฉุฑุฏู ฺฉูุงุณ', 'error');
                        }
                    } catch (error) {
                        console.error('Error cancelling class:', error);
                        showNotification('โ ุฎุทุง ุฏุฑ ฺฉูุณู ฺฉุฑุฏู ฺฉูุงุณ', 'error');
                    }
                }
            });
        }

        // Payment Management Functions
        async function sendPaymentReminder(studentId) {
            // Get student name for the modal
            const student = dashboardData.students?.find(s => s.id === studentId);
            const studentName = student ? student.name : 'ุฏุงูุดุฌู';
            
            // Use the price input modal instead of direct API call
            showPaymentReminderModal(studentId, studentName);
        }


        async function markAsPaid(studentId) {
            showConfirmationModal({
                type: 'success',
                title: 'ุนูุงูุชโฺฏุฐุงุฑ ูพุฑุฏุงุฎุช',
                subtitle: 'ุขุง ูุทูุฆู ูุณุชุฏุ',
                message: 'ุงู ุฏุงูุดุฌู ุจู ุนููุงู ูพุฑุฏุงุฎุช ุดุฏู ุนูุงูุชโฺฏุฐุงุฑ ุฎูุงูุฏ ุดุฏ.',
                confirmText: 'ุชุฃุฏ ฺฉู',
                onConfirm: async () => {
                    try {
                        const response = await fetch(`/api/students/${studentId}/mark-paid`, {
                            method: 'POST'
                        });
                        
                        if (response.ok) {
                            showNotification('โ ุฏุงูุดุฌู ุจู ุนููุงู ูพุฑุฏุงุฎุช ุดุฏู ุนูุงูุชโฺฏุฐุงุฑ ุดุฏ', 'success');
                            // Refresh all data after successful action
                            loadPayments();
                            loadStudents();
                            loadClasses();
                        } else {
                            const error = await response.json();
                            showNotification(`โ ุฎุทุง ุฏุฑ ุนูุงูุชโฺฏุฐุงุฑ ูพุฑุฏุงุฎุช: ${error.error}`, 'error');
                        }
                    } catch (error) {
                        console.error('Error marking as paid:', error);
                        showNotification('โ ุฎุทุง ุฏุฑ ุนูุงูุชโฺฏุฐุงุฑ ูพุฑุฏุงุฎุช', 'error');
                    }
                }
            });
        }

        async function viewPaymentDetails(studentId) {
            try {
                const response = await fetch(`/api/students/${studentId}`);
                if (!response.ok) {
                    showNotification('โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุฌุฒุฆุงุช ูพุฑุฏุงุฎุช', 'error');
                    return;
                }
                
                const student = await response.json();
                
                showViewModal({
                    title: 'ุฌุฒุฆุงุช ูพุฑุฏุงุฎุช',
                    subtitle: `${student.name}`,
                    icon: '๐ฐ',
                    type: 'payment',
                    content: `
                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h5 class="font-semibold text-blue-800 mb-2">ุงุทูุงุนุงุช ุฏุงูุดุฌู</h5>
                                    <p class="text-sm text-blue-700">ูุงู: ${student.name}</p>
                                    <p class="text-sm text-blue-700">ุชููู: ${student.phoneNumber || 'ูุงูุดุฎุต'}</p>
                                    <p class="text-sm text-blue-700">ุดูุฑ: ${student.city || 'ูุงูุดุฎุต'}</p>
                                </div>
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h5 class="font-semibold text-green-800 mb-2">ุงุทูุงุนุงุช ฺฉูุงุณ</h5>
                                    <p class="text-sm text-green-700">ุฌูุณุงุช ุจุงูโูุงูุฏู: ${student.sessionsLeft || 0}</p>
                                    <p class="text-sm text-green-700">ููุน ฺฉูุงุณ: ${student.classType === 'private' ? 'ุฎุตูุต' : 'ฺฏุฑูู'}</p>
                                    <p class="text-sm text-green-700">ุณุทุญ: ${student.level || 'ูุงูุดุฎุต'}</p>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 rounded-lg p-4">
                                <h5 class="font-semibold text-yellow-800 mb-2">ุงุทูุงุนุงุช ูพุฑุฏุงุฎุช</h5>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <p class="text-sm text-yellow-700">ูุถุนุช ูพุฑุฏุงุฎุช:</p>
                                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getPaymentColor(student.paymentStatus)}">
                                            ${getPaymentText(student.paymentStatus)}
                                        </span>
                                    </div>
                                    <div>
                                        <p class="text-sm text-yellow-700">ูุจูุบ ฺฉู:</p>
                                        <p class="font-bold text-yellow-800">500,000 ุชููุงู</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-yellow-700">ุชุงุฑุฎ ุขุฎุฑู ูพุฑุฏุงุฎุช:</p>
                                        <p class="text-yellow-800">${student.lastPaymentDate || 'ูฺ ูพุฑุฏุงุฎุช ุซุจุช ูุดุฏู'}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 rounded-lg p-4">
                                <h5 class="font-semibold text-purple-800 mb-2">ุฑุงูโูุง ูพุฑุฏุงุฎุช</h5>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between p-2 bg-white rounded-lg">
                                        <span class="text-sm text-purple-700">ุดูุงุฑู ฺฉุงุฑุช:</span>
                                        <span class="font-mono text-purple-800">6037-9977-1234-5678</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded-lg">
                                        <span class="text-sm text-purple-700">ุดูุงุฑู ุดุจุง:</span>
                                        <span class="font-mono text-purple-800">IR123456789012345678901234</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded-lg">
                                        <span class="text-sm text-purple-700">ูพุงูฺฉ:</span>
                                        <span class="font-mono text-purple-800">09123456789</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex gap-2">
                                <button onclick="showPaymentReminderModal(${student.id}, '${student.name}')" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors">
                                    ุงุฑุณุงู ุงุฏุขูุฑ
                                </button>
                                <button onclick="markAsPaid(${student.id})" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                    ุนูุงูุชโฺฏุฐุงุฑ ูพุฑุฏุงุฎุช
                                </button>
                            </div>
                        </div>
                    `
                });
            } catch (error) {
                console.error('Error viewing payment details:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุฌุฒุฆุงุช ูพุฑุฏุงุฎุช', 'error');
            }
        }

        function exportPaymentReport() {
            showNotification('๐ ฺฏุฒุงุฑุด ูุงู ุฏุฑ ุญุงู ุขูุงุฏูโุณุงุฒ...', 'info');
            // Implementation for exporting payment report
            setTimeout(() => {
                showNotification('โ ฺฏุฒุงุฑุด ูุงู ุขูุงุฏู ุดุฏ', 'success');
            }, 2000);
        }

        // Calendar helper functions
        function generateCalendarGrid(date, classes) {
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            let calendarHTML = '';
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                calendarHTML += '<div class="h-20"></div>';
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDate = new Date(year, month, day);
                const dayClasses = classes.filter(cls => {
                    const clsDate = new Date(cls.date);
                    return clsDate.getDate() === day && clsDate.getMonth() === month && clsDate.getFullYear() === year;
                });
                
                const isToday = currentDate.toDateString() === new Date().toDateString();
                
                calendarHTML += `
                    <div class="h-20 p-2 border border-gray-200 rounded-lg ${isToday ? 'bg-blue-50 border-blue-300' : 'bg-white hover:bg-gray-50'}">
                        <div class="text-sm font-medium text-gray-700 mb-1">${day}</div>
                        <div class="space-y-1">
                            ${dayClasses.map(cls => {
                                const paymentStatus = cls.student ? cls.student.paymentStatus : 'unpaid';
                                const isCancelled = ['cancelled', 'cancelled_by_student', 'cancelled_by_teacher'].includes(cls.status);
                                
                                let bgColor, textColor, hoverColor, icon;
                                
                                if (isCancelled) {
                                    bgColor = 'bg-red-100';
                                    textColor = 'text-red-700';
                                    hoverColor = 'hover:bg-red-200';
                                    icon = 'โ';
                                } else if (paymentStatus === 'paid') {
                                    bgColor = 'bg-green-100';
                                    textColor = 'text-green-700';
                                    hoverColor = 'hover:bg-green-200';
                                    icon = 'โ';
                                } else {
                                    bgColor = 'bg-yellow-100';
                                    textColor = 'text-yellow-700';
                                    hoverColor = 'hover:bg-yellow-200';
                                    icon = '๐ฐ';
                                }
                                
                                const statusText = isCancelled ? 'ูุบู ุดุฏู' : (paymentStatus === 'paid' ? 'ูพุฑุฏุงุฎุช ุดุฏู' : 'ูพุฑุฏุงุฎุช ูุดุฏู');
                                
                                return `
                                    <div class="text-xs ${bgColor} ${textColor} px-2 py-1 rounded truncate cursor-pointer ${hoverColor}" 
                                         title="${cls.student ? cls.student.name : 'ูุงูุดุฎุต'} - ${cls.time} - ${statusText}"
                                         onclick="viewClassDetails(${cls.id})">
                                        ${icon} ${cls.student ? cls.student.name : 'ูุงูุดุฎุต'} - ${cls.time}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            return calendarHTML;
        }

        // Calendar navigation
        let currentCalendarDate = new Date();

        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            updateCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            updateCalendar();
        }

        function updateCalendar() {
            const upcomingClasses = dashboardData.upcomingClasses || [];
            
            // Group classes by month
            const classesByMonth = {};
            upcomingClasses.forEach(cls => {
                const date = new Date(cls.date);
                const monthKey = `${date.getFullYear()}-${date.getMonth()}`;
                if (!classesByMonth[monthKey]) {
                    classesByMonth[monthKey] = [];
                }
                classesByMonth[monthKey].push(cls);
            });
            
            const currentMonth = `${currentCalendarDate.getFullYear()}-${currentCalendarDate.getMonth()}`;
            const calendarGrid = document.getElementById('calendar-grid');
            const monthDisplay = document.getElementById('current-month-display');
            
            if (calendarGrid) {
                calendarGrid.innerHTML = generateCalendarGrid(currentCalendarDate, classesByMonth[currentMonth] || []);
            }
            
            if (monthDisplay) {
                monthDisplay.textContent = currentCalendarDate.toLocaleDateString('fa-IR', { year: 'numeric', month: 'long' });
            }
        }

        // Test class management functions
        async function approveTestClass(studentId) {
            // Find student data for display
            const student = dashboardData.students.find(s => s.id === studentId);
            
            showConfirmationModal({
                type: 'success',
                title: 'ุชุฃุฏ ฺฉูุงุณ ุขุฒูุงุด',
                subtitle: 'ุฏุฑุฎูุงุณุช ฺฉูุงุณ ุขุฒูุงุด',
                message: 'ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ฺฉูุงุณ ุขุฒูุงุด ุฑุง ุชุฃุฏ ฺฉูุฏุ',
                details: student ? `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-medium">ูุงู ุฏุงูุดุฌู:</span>
                            <span>${student.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุดูุงุฑู ุชููู:</span>
                            <span>${student.phoneNumber || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุดูุฑ:</span>
                            <span>${student.city || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุชุงุฑุฎ ุฏุฑุฎูุงุณุช:</span>
                            <span>${new Date(student.createdAt).toLocaleDateString('fa-IR')}</span>
                        </div>
                    </div>
                ` : '',
                confirmText: 'ุชุฃุฏ ฺฉูุงุณ',
                onConfirm: async () => {
                    try {
                        showNotification('ุฏุฑ ุญุงู ุชุฃุฏ ฺฉูุงุณ ุขุฒูุงุด...', 'info', 0);
                        
                        const response = await fetch(`/api/students/${studentId}/approve`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                sessionsLeft: 1,
                                sessionsPerWeek: 1,
                                selectedDays: ['ุฏูุดูุจู'],
                                classTimes: [{ day: 'ุฏูุดูุจู', time: '14:00' }],
                                paymentStatus: 'unpaid'
                            })
                        });
                        
                        if (response.ok) {
                            showNotification('โ ฺฉูุงุณ ุขุฒูุงุด ุจุง ููููุช ุชุฃุฏ ุดุฏ! ูพุงู ุชุฃุฏ ุจุฑุง ุฏุงูุดุฌู ุงุฑุณุงู ุดุฏ.', 'success');
                            // Reload the test classes data
                            await loadTestClasses();
                        } else {
                            showNotification('โ ุฎุทุง ุฏุฑ ุชุฃุฏ ฺฉูุงุณ ุขุฒูุงุด', 'error');
                        }
                    } catch (error) {
                        console.error('Error approving test class:', error);
                        showNotification('โ ุฎุทุง ุฏุฑ ุชุฃุฏ ฺฉูุงุณ ุขุฒูุงุด', 'error');
                    }
                }
            });
        }

        async function rejectTestClass(studentId) {
            // Find student data for display
            const student = dashboardData.students.find(s => s.id === studentId);
            
            showConfirmationModal({
                type: 'error',
                title: 'ุฑุฏ ฺฉุฑุฏู ฺฉูุงุณ ุขุฒูุงุด',
                subtitle: 'ุฏุฑุฎูุงุณุช ฺฉูุงุณ ุขุฒูุงุด',
                message: 'ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ฺฉูุงุณ ุขุฒูุงุด ุฑุง ุฑุฏ ฺฉูุฏุ',
                details: student ? `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-medium">ูุงู ุฏุงูุดุฌู:</span>
                            <span>${student.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุดูุงุฑู ุชููู:</span>
                            <span>${student.phoneNumber || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุดูุฑ:</span>
                            <span>${student.city || 'ูุงูุดุฎุต'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ุชุงุฑุฎ ุฏุฑุฎูุงุณุช:</span>
                            <span>${new Date(student.createdAt).toLocaleDateString('fa-IR')}</span>
                        </div>
                    </div>
                ` : '',
                confirmText: 'ุฑุฏ ฺฉุฑุฏู ฺฉูุงุณ',
                onConfirm: async () => {
                    try {
                        showNotification('ุฏุฑ ุญุงู ุฑุฏ ฺฉุฑุฏู ฺฉูุงุณ ุขุฒูุงุด...', 'info', 0);
                        
                        const response = await fetch(`/api/students/${studentId}/reject`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' }
                        });
                        
                        if (response.ok) {
                            showNotification('โ ฺฉูุงุณ ุขุฒูุงุด ุฑุฏ ุดุฏ. ูพุงู ุฑุฏ ุดุฏู ุจุฑุง ุฏุงูุดุฌู ุงุฑุณุงู ุดุฏ.', 'warning');
                            // Reload the test classes data
                            await loadTestClasses();
                        } else {
                            showNotification('โ ุฎุทุง ุฏุฑ ุฑุฏ ฺฉุฑุฏู ฺฉูุงุณ ุขุฒูุงุด', 'error');
                        }
                    } catch (error) {
                        console.error('Error rejecting test class:', error);
                        showNotification('โ ุฎุทุง ุฏุฑ ุฑุฏ ฺฉุฑุฏู ฺฉูุงุณ ุขุฒูุงุด', 'error');
                    }
                }
            });
        }

        function viewTestClassDetails(studentId) {
            const student = dashboardData.students?.find(s => s.id === studentId);
            if (!student) {
                showNotification('โ ุฏุฑุฎูุงุณุช ฺฉูุงุณ ุขุฒูุงุด ุงูุช ูุดุฏ', 'error');
                return;
            }

            const content = `
                <div class="space-y-6">
                    <!-- Test Class Header -->
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-blue-400 rounded-full flex items-center justify-center text-white text-2xl">
                                ๐
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">ุฏุฑุฎูุงุณุช ฺฉูุงุณ ุขุฒูุงุด</h3>
                                <p class="text-gray-600">ฺฉูุงุณ ุขุฒูุงุด ุฑุงฺฏุงู</p>
                            </div>
                        </div>
                    </div>

                    <!-- Student Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ุงุทูุงุนุงุช ุฏุงูุดุฌู</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-600">ูุงู ฺฉุงูู:</span>
                                    <span class="text-gray-800 font-medium">${student.name || 'ูุงูุดุฎุต'}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-600">ุดูุงุฑู ุชููู:</span>
                                    <span class="text-gray-800">${student.phoneNumber || 'ูุงูุดุฎุต'}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-600">ุงูู:</span>
                                    <span class="text-gray-800">${student.email || 'ูุงูุดุฎุต'}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-600">ุดูุฑ:</span>
                                    <span class="text-gray-800">${student.city || 'ูุงูุดุฎุต'}</span>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ูุถุนุช ุฏุฑุฎูุงุณุช</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-600">ูุถุนุช:</span>
                                    <span class="px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(student.registrationStatus)}">
                                        ${getStatusText(student.registrationStatus)}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-600">ุชุงุฑุฎ ุฏุฑุฎูุงุณุช:</span>
                                    <span class="text-gray-800">${new Date(student.createdAt).toLocaleDateString('fa-IR')}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-600">ุณุงุนุช ุฏุฑุฎูุงุณุช:</span>
                                    <span class="text-gray-800">${new Date(student.createdAt).toLocaleTimeString('fa-IR')}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-600">ุขุฎุฑู ุจุฑูุฒุฑุณุงู:</span>
                                    <span class="text-gray-800">${new Date(student.updatedAt).toLocaleDateString('fa-IR')}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Class Details -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ุฌุฒุฆุงุช ฺฉูุงุณ ุขุฒูุงุด</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-blue-50 rounded-lg p-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-blue-600">๐</span>
                                    <span class="font-medium text-blue-800">ุฒูุงู ุงูุชุฎุงุจ ุดุฏู</span>
                                </div>
                                <p class="text-blue-700">${student.selectedTime || 'ุฒูุงู ุฏุฑ ุชููู ุงูุชุฎุงุจ ุดุฏู'}</p>
                            </div>
                            <div class="bg-green-50 rounded-lg p-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-green-600">๐ฏ</span>
                                    <span class="font-medium text-green-800">ููุน ฺฉูุงุณ</span>
                                </div>
                                <p class="text-green-700">ฺฉูุงุณ ุขุฒูุงุด ุฑุงฺฏุงู</p>
                            </div>
                        </div>
                    </div>

                    <!-- Learning Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ุงุทูุงุนุงุช ุงุฏฺฏุฑ</h4>
                        <div class="space-y-3">
                            <div>
                                <span class="font-medium text-gray-600 block mb-2">ุฏูู ุนูุงูู ุจู ุงุฏฺฏุฑ ูุฑุงูุณู:</span>
                                <p class="text-gray-800 text-sm bg-gray-50 p-3 rounded-lg">${student.learningReason || 'ูุงูุดุฎุต'}</p>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600 block mb-2">ุชุฌุฑุจู ูุจู ุฏุฑ ุฒุจุงู ูุฑุงูุณู:</span>
                                <p class="text-gray-800 text-sm bg-gray-50 p-3 rounded-lg">${student.experience || 'ูุงูุดุฎุต'}</p>
                            </div>
                            <div>
                                <span class="font-medium text-gray-600 block mb-2">ุชูุถุญุงุช ุงุถุงู:</span>
                                <p class="text-gray-800 text-sm bg-gray-50 p-3 rounded-lg">${student.additionalInfo || 'ูุงูุดุฎุต'}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-2">ุงุทูุงุนุงุช ุชูุงุณ</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">๐ฑ</span>
                                <div>
                                    <p class="font-medium text-gray-800">ุชููู</p>
                                    <p class="text-sm text-gray-600">${student.phoneNumber || 'ูุงูุดุฎุต'}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">๐ง</span>
                                <div>
                                    <p class="font-medium text-gray-800">ุงูู</p>
                                    <p class="text-sm text-gray-600">${student.email || 'ูุงูุดุฎุต'}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Status -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <h5 class="font-medium text-gray-800">ูุถุนุช ุงูุฏุงู</h5>
                                <p class="text-sm text-gray-600">${student.registrationStatus === 'pending' ? 'ุฏุฑ ุงูุชุธุงุฑ ุจุฑุฑุณ' : student.registrationStatus === 'approved' ? 'ุชุฃุฏ ุดุฏู' : 'ุฑุฏ ุดุฏู'}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500">ุขุฎุฑู ุจุฑูุฒุฑุณุงู</p>
                                <p class="text-sm font-medium text-gray-700">${new Date(student.updatedAt).toLocaleString('fa-IR')}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            showViewModal({
                type: 'test',
                title: 'ุฌุฒุฆุงุช ฺฉูุงุณ ุขุฒูุงุด',
                subtitle: student.name,
                icon: '๐',
                content: content
            });
        }

        function cancelTestClass(studentId) {
            if (confirm('ุขุง ูุทูุฆู ูุณุชุฏ ฺฉู ูโุฎูุงูุฏ ุงู ฺฉูุงุณ ุขุฒูุงุด ุฑุง ูุบู ฺฉูุฏุ')) {
                console.log('Cancelling test class for student:', studentId);
                // Implementation for cancelling test class
            }
        }

        // Homework functions
        function viewHomeworkDetails(homeworkId) {
            const homework = dashboardData.homework?.find(hw => hw.id === homeworkId);
            if (!homework) return;

            const modal = document.getElementById('view-modal');
            const modalContent = document.getElementById('view-modal-content');
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">๐ ุฌุฒุฆุงุช ุชฺฉูู</h3>
                        <button onclick="hideViewModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-pink-50 rounded-lg p-4">
                            <h4 class="font-semibold text-pink-800 mb-2">๐ค ุฏุงูุดโุขููุฒ</h4>
                            <p class="text-pink-700">${homework.student.name}</p>
                            <p class="text-sm text-pink-600">${homework.student.phoneNumber || 'ุจุฏูู ุดูุงุฑู'}</p>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">๐ ุนููุงู ุชฺฉูู</h4>
                            <p class="text-blue-700">${homework.title || 'ุจุฏูู ุนููุงู'}</p>
                        </div>
                        
                        <div class="bg-green-50 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 mb-2">๐ ุชูุถุญุงุช</h4>
                            <p class="text-green-700 whitespace-pre-wrap">${homework.description || 'ุจุฏูู ุชูุถุญุงุช'}</p>
                        </div>
                        
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <h4 class="font-semibold text-yellow-800 mb-2">๐ ูุถุนุช</h4>
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${getHomeworkStatusColor(homework.status)}">
                                ${getHomeworkStatusText(homework.status)}
                            </span>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-2">๐ ุชุงุฑุฎ ุงุฑุณุงู</h4>
                            <p class="text-gray-700">${new Date(homework.submittedAt).toLocaleDateString('fa-IR')}</p>
                        </div>
                        
                        ${homework.teacherNotes ? `
                            <div class="bg-purple-50 rounded-lg p-4">
                                <h4 class="font-semibold text-purple-800 mb-2">๐ ูุธุฑุงุช ูุนูู</h4>
                                <p class="text-purple-700 whitespace-pre-wrap">${homework.teacherNotes}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        function updateHomeworkStatus(homeworkId) {
            const homework = dashboardData.homework?.find(hw => hw.id === homeworkId);
            if (!homework) return;

            const modal = document.getElementById('view-modal');
            const modalContent = document.getElementById('view-modal-content');
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">๐ ุจูโุฑูุฒุฑุณุงู ูุถุนุช ุชฺฉูู</h3>
                        <button onclick="hideViewModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-pink-50 rounded-lg p-4">
                            <h4 class="font-semibold text-pink-800 mb-2">๐ค ุฏุงูุดโุขููุฒ</h4>
                            <p class="text-pink-700">${homework.student.name}</p>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">๐ ุนููุงู ุชฺฉูู</h4>
                            <p class="text-blue-700">${homework.title || 'ุจุฏูู ุนููุงู'}</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ูุถุนุช ุฌุฏุฏ</label>
                            <select id="homework-status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                                <option value="submitted" ${homework.status === 'submitted' ? 'selected' : ''}>ุงุฑุณุงู ุดุฏู</option>
                                <option value="reviewed" ${homework.status === 'reviewed' ? 'selected' : ''}>ุจุฑุฑุณ ุดุฏู</option>
                                <option value="approved" ${homework.status === 'approved' ? 'selected' : ''}>ุชุฃุฏ ุดุฏู</option>
                                <option value="needs_revision" ${homework.status === 'needs_revision' ? 'selected' : ''}>ูุงุฒ ุจู ุจุงุฒูฺฏุฑ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ูุธุฑุงุช ูุนูู (ุงุฎุชุงุฑ)</label>
                            <textarea id="homework-notes" rows="4" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
                                      placeholder="ูุธุฑุงุช ุฎูุฏ ุฑุง ุฏุฑ ููุฑุฏ ุชฺฉูู ุจููุณุฏ...">${homework.teacherNotes || ''}</textarea>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 justify-end mt-6 pt-4 border-t border-gray-200">
                        <button onclick="hideViewModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors font-medium">
                            ุงูุตุฑุงู
                        </button>
                        <button onclick="saveHomeworkStatus(${homeworkId})" class="px-6 py-2 bg-pink-500 text-white rounded-xl hover:bg-pink-600 transition-colors font-medium">
                            ุฐุฎุฑู ุชุบุฑุงุช
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        async function saveHomeworkStatus(homeworkId) {
            const status = document.getElementById('homework-status').value;
            const teacherNotes = document.getElementById('homework-notes').value;
            
            try {
                showNotification('ุฏุฑ ุญุงู ุฐุฎุฑู ุชุบุฑุงุช...', 'info', 0);
                
                const response = await fetch(`/api/homework/${homeworkId}/update-status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status, teacherNotes })
                });
                
                if (response.ok) {
                    showNotification('โ ูุถุนุช ุชฺฉูู ุจูโุฑูุฒุฑุณุงู ุดุฏ', 'success');
                    hideViewModal();
                    loadHomework();
                } else {
                    const error = await response.json();
                    showNotification(`โ ุฎุทุง ุฏุฑ ุจูโุฑูุฒุฑุณุงู: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error updating homework status:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุจูโุฑูุฒุฑุณุงู ูุถุนุช ุชฺฉูู', 'error');
            }
        }

        // Question functions
        function viewQuestionDetails(questionId) {
            const question = dashboardData.questions?.find(q => q.id === questionId);
            if (!question) return;

            const modal = document.getElementById('view-modal');
            const modalContent = document.getElementById('view-modal-content');
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">โ ุฌุฒุฆุงุช ุณูุงู</h3>
                        <button onclick="hideViewModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-pink-50 rounded-lg p-4">
                            <h4 class="font-semibold text-pink-800 mb-2">๐ค ุฏุงูุดโุขููุฒ</h4>
                            <p class="text-pink-700">${question.student.name}</p>
                            <p class="text-sm text-pink-600">${question.student.phoneNumber || 'ุจุฏูู ุดูุงุฑู'}</p>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">โ ุณูุงู</h4>
                            <p class="text-blue-700 whitespace-pre-wrap">${question.question}</p>
                        </div>
                        
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <h4 class="font-semibold text-yellow-800 mb-2">๐ ูุถุนุช</h4>
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${getQuestionStatusColor(question.status)}">
                                ${getQuestionStatusText(question.status)}
                            </span>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-2">๐ ุชุงุฑุฎ ูพุฑุณุด</h4>
                            <p class="text-gray-700">${new Date(question.createdAt).toLocaleDateString('fa-IR')}</p>
                        </div>
                        
                        ${question.response ? `
                            <div class="bg-green-50 rounded-lg p-4">
                                <h4 class="font-semibold text-green-800 mb-2">๐ฌ ูพุงุณุฎ ุดูุง</h4>
                                <p class="text-green-700 whitespace-pre-wrap">${question.response}</p>
                                <p class="text-sm text-green-600 mt-2">ูพุงุณุฎ ุฏุงุฏู ุดุฏู ุฏุฑ: ${new Date(question.answeredAt).toLocaleDateString('fa-IR')}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        function answerQuestion(questionId) {
            const question = dashboardData.questions?.find(q => q.id === questionId);
            if (!question) return;

            const modal = document.getElementById('view-modal');
            const modalContent = document.getElementById('view-modal-content');
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">๐ฌ ูพุงุณุฎ ุจู ุณูุงู</h3>
                        <button onclick="hideViewModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-pink-50 rounded-lg p-4">
                            <h4 class="font-semibold text-pink-800 mb-2">๐ค ุฏุงูุดโุขููุฒ</h4>
                            <p class="text-pink-700">${question.student.name}</p>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-800 mb-2">โ ุณูุงู</h4>
                            <p class="text-blue-700 whitespace-pre-wrap">${question.question}</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ูพุงุณุฎ ุดูุง</label>
                            <textarea id="question-response" rows="6" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
                                      placeholder="ูพุงุณุฎ ุฎูุฏ ุฑุง ุจููุณุฏ..."></textarea>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 justify-end mt-6 pt-4 border-t border-gray-200">
                        <button onclick="hideViewModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors font-medium">
                            ุงูุตุฑุงู
                        </button>
                        <button onclick="saveQuestionResponse(${questionId})" class="px-6 py-2 bg-pink-500 text-white rounded-xl hover:bg-pink-600 transition-colors font-medium">
                            ุงุฑุณุงู ูพุงุณุฎ
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        async function saveQuestionResponse(questionId) {
            const response = document.getElementById('question-response').value.trim();
            
            if (!response) {
                showNotification('โ ูุทูุงู ูพุงุณุฎ ุฑุง ูุงุฑุฏ ฺฉูุฏ', 'error');
                return;
            }
            
            try {
                showNotification('ุฏุฑ ุญุงู ุงุฑุณุงู ูพุงุณุฎ...', 'info', 0);
                
                const apiResponse = await fetch(`/api/questions/${questionId}/answer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ response })
                });
                
                if (apiResponse.ok) {
                    showNotification('โ ูพุงุณุฎ ุงุฑุณุงู ุดุฏ', 'success');
                    hideViewModal();
                    loadQuestions();
                } else {
                    const error = await apiResponse.json();
                    showNotification(`โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ูพุงุณุฎ: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error answering question:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ูพุงุณุฎ', 'error');
            }
        }

        // Edit student function
        function editStudent(studentId) {
            const student = dashboardData.students?.find(s => s.id === studentId);
            if (!student) {
                showNotification('โ ุฏุงูุดโุขููุฒ ุงูุช ูุดุฏ', 'error');
                return;
            }

            const modal = document.getElementById('view-modal');
            const modalContent = document.getElementById('view-modal-content');
            
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">โ๏ธ ูุฑุงุด ุฏุงูุดโุขููุฒ</h3>
                        <button onclick="hideViewModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-pink-50 rounded-lg p-4">
                            <h4 class="font-semibold text-pink-800 mb-2">๐ค ุงุทูุงุนุงุช ุฏุงูุดโุขููุฒ</h4>
                            <p class="text-pink-700">${student.name}</p>
                            <p class="text-sm text-pink-600">${student.phoneNumber || 'ุจุฏูู ุดูุงุฑู'}</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ูุงู ู ูุงู ุฎุงููุงุฏฺฏ</label>
                                <input type="text" id="edit-student-name" value="${student.name}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุดูุงุฑู ุชููู</label>
                                <input type="text" id="edit-student-phone" value="${student.phoneNumber || ''}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ููุน ฺฉูุงุณ</label>
                                <select id="edit-student-class-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                                    <option value="private" ${student.classType === 'private' ? 'selected' : ''}>ุฎุตูุต</option>
                                    <option value="group" ${student.classType === 'group' ? 'selected' : ''}>ฺฏุฑูู</option>
                                    <option value="test" ${student.classType === 'test' ? 'selected' : ''}>ุขุฒูุงุด</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุดูุงุณู ฺฏุฑูู (ุจุฑุง ฺฉูุงุณโูุง ฺฏุฑูู)</label>
                                <input type="text" id="edit-student-group-id" value="${student.groupId || ''}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
                                       placeholder="ูุซุงู: GROUP-001">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุณุทุญ ุฒุจุงู</label>
                                <select id="edit-student-level" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                                    <option value="beginner" ${student.level === 'beginner' ? 'selected' : ''}>ูุจุชุฏ</option>
                                    <option value="intermediate" ${student.level === 'intermediate' ? 'selected' : ''}>ูุชูุณุท</option>
                                    <option value="advanced" ${student.level === 'advanced' ? 'selected' : ''}>ูพุดุฑูุชู</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ุฌูุณุงุช ุจุงูโูุงูุฏู</label>
                                <input type="number" id="edit-student-sessions" value="${student.sessionsLeft || 0}" min="0"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ูุถุนุช ูพุฑุฏุงุฎุช</label>
                                <select id="edit-student-payment" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                                    <option value="paid" ${student.paymentStatus === 'paid' ? 'selected' : ''}>ูพุฑุฏุงุฎุช ุดุฏู</option>
                                    <option value="unpaid" ${student.paymentStatus === 'unpaid' ? 'selected' : ''}>ูพุฑุฏุงุฎุช ูุดุฏู</option>
                                    <option value="overdue" ${student.paymentStatus === 'overdue' ? 'selected' : ''}>ูพุฑุฏุงุฎุช ูุนูู</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ูุถุนุช ุซุจุชโูุงู</label>
                                <select id="edit-student-status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500">
                                    <option value="pending" ${student.registrationStatus === 'pending' ? 'selected' : ''}>ุฏุฑ ุงูุชุธุงุฑ</option>
                                    <option value="approved" ${student.registrationStatus === 'approved' ? 'selected' : ''}>ุชุฃุฏ ุดุฏู</option>
                                    <option value="rejected" ${student.registrationStatus === 'rejected' ? 'selected' : ''}>ุฑุฏ ุดุฏู</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุฑูุฒูุง ฺฉูุงุณ (ุงุฎุชุงุฑ)</label>
                            <input type="text" id="edit-student-days" value="${student.selectedDays || ''}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
                                   placeholder="ูุซุงู: ุฏูุดูุจู,ฺูุงุฑุดูุจู">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ุณุงุนุงุช ฺฉูุงุณ (ุงุฎุชุงุฑ)</label>
                            <input type="text" id="edit-student-times" value="${student.selectedTimes || ''}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
                                   placeholder="ูุซุงู: ุฏูุดูุจู:16:00,ฺูุงุฑุดูุจู:17:00">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 justify-end mt-6 pt-4 border-t border-gray-200">
                        <button onclick="hideViewModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors font-medium">
                            ุงูุตุฑุงู
                        </button>
                        <button onclick="saveStudentChanges(${studentId})" class="px-6 py-2 bg-pink-500 text-white rounded-xl hover:bg-pink-600 transition-colors font-medium">
                            ุฐุฎุฑู ุชุบุฑุงุช
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }

        async function saveStudentChanges(studentId) {
            const updateData = {
                name: document.getElementById('edit-student-name').value.trim(),
                phoneNumber: document.getElementById('edit-student-phone').value.trim(),
                classType: document.getElementById('edit-student-class-type').value,
                groupId: document.getElementById('edit-student-group-id').value.trim() || null,
                level: document.getElementById('edit-student-level').value,
                sessionsLeft: parseInt(document.getElementById('edit-student-sessions').value) || 0,
                paymentStatus: document.getElementById('edit-student-payment').value,
                registrationStatus: document.getElementById('edit-student-status').value,
                selectedDays: document.getElementById('edit-student-days').value.trim() || null,
                selectedTimes: document.getElementById('edit-student-times').value.trim() || null
            };
            
            if (!updateData.name) {
                showNotification('โ ูุงู ุฏุงูุดโุขููุฒ ุงูุฒุงู ุงุณุช', 'error');
                return;
            }
            
            try {
                showNotification('ุฏุฑ ุญุงู ุฐุฎุฑู ุชุบุฑุงุช...', 'info', 0);
                
                const response = await fetch(`/api/students/${studentId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateData)
                });
                
                if (response.ok) {
                    showNotification('โ ุชุบุฑุงุช ุฏุงูุดโุขููุฒ ุฐุฎุฑู ุดุฏ', 'success');
                    hideViewModal();
                    loadStudents();
                } else {
                    const error = await response.json();
                    showNotification(`โ ุฎุทุง ุฏุฑ ุฐุฎุฑู ุชุบุฑุงุช: ${error.error}`, 'error');
                }
            } catch (error) {
                console.error('Error updating student:', error);
                showNotification('โ ุฎุทุง ุฏุฑ ุฐุฎุฑู ุชุบุฑุงุช ุฏุงูุดโุขููุฒ', 'error');
            }
        }

        // Reschedule class function
        function rescheduleClass(classId) {
            showNotification('๐ ุฏุฑ ุญุงู ุจุงุฒฺฏุฑุฏุงู ฺฉูุงุณ...', 'info');
            // Implementation for rescheduling cancelled classes
        }
    </script>
</body>
</html>